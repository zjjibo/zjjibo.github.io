<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>SQL题目记录(一) | zZZZ's Blog</title><meta name="keywords" content="SQL,LeetCode,LintCode,记录"><meta name="author" content="Zj_Jibo"><meta name="copyright" content="Zj_Jibo"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="删除重复的电子邮箱2022-04-23 🙈Introduction12345678+-------------+---------+| Column Name | Type    |+-------------+---------+| id          | int     || email       | varchar |+-------------+---------+id是该表的主键">
<meta property="og:type" content="article">
<meta property="og:title" content="SQL题目记录(一)">
<meta property="og:url" content="http://example.com/2022/05/01/SQL%E9%A2%98%E7%9B%AE%E8%AE%B0%E5%BD%95(%E4%B8%80)/index.html">
<meta property="og:site_name" content="zZZZ&#39;s Blog">
<meta property="og:description" content="删除重复的电子邮箱2022-04-23 🙈Introduction12345678+-------------+---------+| Column Name | Type    |+-------------+---------+| id          | int     || email       | varchar |+-------------+---------+id是该表的主键">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2022/04/29/XE8p2nWdrub9SOG.png">
<meta property="article:published_time" content="2022-05-01T02:45:10.000Z">
<meta property="article:modified_time" content="2022-05-01T07:16:58.545Z">
<meta property="article:author" content="Zj_Jibo">
<meta property="article:tag" content="SQL">
<meta property="article:tag" content="LeetCode">
<meta property="article:tag" content="LintCode">
<meta property="article:tag" content="记录">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2022/04/29/XE8p2nWdrub9SOG.png"><link rel="shortcut icon" href="https://s2.loli.net/2022/04/28/xONf6RXakT8oIu1.jpg"><link rel="canonical" href="http://example.com/2022/05/01/SQL%E9%A2%98%E7%9B%AE%E8%AE%B0%E5%BD%95(%E4%B8%80)/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'SQL题目记录(一)',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-05-01 15:16:58'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><link rel="stylesheet" href="APlayer.min.css"><div id="aplayer"></div><script src="https://cdn.jsdelivr.net/gh/radium-bit/res@master/live2d/autoload.js" async></script><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/sviptzk/StaticFile_HEXO@latest/butterfly/css/macWhite.css"><link rel="stylesheet" href="/css/aplayerdiy.css"><link rel="stylesheet" href="/css/mouse.css"><link rel="stylesheet" href="/css/badge.css"><meta name="generator" content="Hexo 6.1.0"><link rel="alternate" href="/atom.xml" title="zZZZ's Blog" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://s2.loli.net/2022/04/28/xONf6RXakT8oIu1.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">6</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">16</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fa fa-comments-o"></i><span> 分享</span></a></li><li><a class="site-page child" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i><span> 相册</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 影视</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://s2.loli.net/2022/04/29/XE8p2nWdrub9SOG.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">zZZZ's Blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fa fa-comments-o"></i><span> 分享</span></a></li><li><a class="site-page child" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i><span> 相册</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 影视</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">SQL题目记录(一)</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-05-01T02:45:10.000Z" title="发表于 2022-05-01 10:45:10">2022-05-01</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-05-01T07:16:58.545Z" title="更新于 2022-05-01 15:16:58">2022-05-01</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/SQL/">SQL</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="SQL题目记录(一)"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="删除重复的电子邮箱"><a href="#删除重复的电子邮箱" class="headerlink" title="删除重复的电子邮箱"></a>删除重复的电子邮箱</h2><p>2022-04-23</p>
<h4 id="🙈Introduction"><a href="#🙈Introduction" class="headerlink" title="🙈Introduction"></a>🙈Introduction</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">-------------+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">Column</span> Name <span class="operator">|</span> Type    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+---------+</span></span><br><span class="line"><span class="operator">|</span> id          <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> email       <span class="operator">|</span> <span class="type">varchar</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+---------+</span></span><br><span class="line">id是该表的主键列。</span><br><span class="line">该表的每一行包含一封电子邮件。电子邮件将不包含大写字母。</span><br></pre></td></tr></table></figure>
<p>编写一个 SQL <strong>删除语句</strong>来 <strong>删除</strong> 所有重复的电子邮件，只保留一个id最小的唯一电子邮件。</p>
<h4 id="🤔code"><a href="#🤔code" class="headerlink" title="🤔code"></a>🤔code</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> p1 <span class="keyword">from</span> Person p1,Person p2</span><br><span class="line"><span class="keyword">where</span> p1.email<span class="operator">=</span>p2.email <span class="keyword">and</span> p1.id<span class="operator">&gt;</span>p2.id;</span><br></pre></td></tr></table></figure>
<h4 id="💪get"><a href="#💪get" class="headerlink" title="💪get"></a>💪get</h4><ul>
<li>delete可以写成<code>delete table1 from table1,table2 where ……</code>![[SQL基础#DELETE|delete]]</li>
</ul>
<h4 id="🙃source"><a href="#🙃source" class="headerlink" title="🙃source"></a>🙃source</h4><p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/delete-duplicate-emails/">source</a></p>
<h2 id="计算特殊奖金"><a href="#计算特殊奖金" class="headerlink" title="计算特殊奖金"></a>计算特殊奖金</h2><p>2022-04-23</p>
<h4 id="🙈Introduction-1"><a href="#🙈Introduction-1" class="headerlink" title="🙈Introduction"></a>🙈Introduction</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| 列名        | 类型     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| employee_id | int     |</span><br><span class="line">| name        | varchar |</span><br><span class="line">| salary      | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">employee_id 是这个表的主键。</span><br><span class="line">此表的每一行给出了雇员id ，名字和薪水。</span><br></pre></td></tr></table></figure>
<p>写出一个SQL 查询语句，计算每个雇员的奖金。如果一个雇员的id是奇数并且他的名字不是以’M’开头，那么他的奖金是他工资的100%，否则奖金为0。</p>
<h4 id="🤔code-1"><a href="#🤔code-1" class="headerlink" title="🤔code"></a>🤔code</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#######<span class="number">1</span>########<span class="number">611</span>ms</span><br><span class="line"><span class="keyword">select</span> employee_id,</span><br><span class="line">if (employee_id<span class="operator">%</span><span class="number">2</span><span class="operator">!=</span><span class="number">0</span> <span class="keyword">and</span> name <span class="keyword">not</span> <span class="keyword">like</span> <span class="string">&#x27;M%&#x27;</span>,salary,<span class="number">0</span>) bonus </span><br><span class="line"><span class="keyword">from</span> Employees;</span><br><span class="line"></span><br><span class="line">#######<span class="number">2</span>#######<span class="number">570</span>ms</span><br><span class="line"><span class="keyword">select</span> employee_id,</span><br><span class="line">    <span class="keyword">case</span> </span><br><span class="line">        <span class="keyword">when</span> employee_id<span class="operator">%</span><span class="number">2</span><span class="operator">!=</span><span class="number">0</span> <span class="keyword">and</span> name <span class="keyword">not</span> <span class="keyword">like</span> <span class="string">&#x27;M%&#x27;</span> <span class="keyword">then</span> salary <span class="keyword">else</span> <span class="number">0</span> </span><br><span class="line">    <span class="keyword">end</span> bonus</span><br><span class="line"><span class="keyword">from</span> Employees;</span><br><span class="line">#########<span class="number">3</span>########<span class="number">619</span>ms</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> employee_id,</span><br><span class="line">    <span class="keyword">case</span> </span><br><span class="line">        <span class="keyword">when</span> employee_id<span class="operator">%</span><span class="number">2</span><span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> <span class="keyword">left</span>(name,<span class="number">1</span>)<span class="operator">!=</span><span class="string">&#x27;M&#x27;</span> </span><br><span class="line">        <span class="keyword">then</span> salary </span><br><span class="line">        <span class="keyword">else</span> <span class="number">0</span> </span><br><span class="line">    <span class="keyword">end</span> bonus</span><br><span class="line"><span class="keyword">from</span> Employees;</span><br></pre></td></tr></table></figure>
<h4 id="💪get-1"><a href="#💪get-1" class="headerlink" title="💪get"></a>💪get</h4><ul>
<li>if:可以放在select之后作为输出项，对输出进行条件筛选，基本语法为：<code>if(条件,Ture:输出1,FALSE:输出2) as name</code>。</li>
<li>case：作为select的输出项，对输出进行条件筛选，基本语法为:<code>case when 条件 then True:输出1 else FALSE：输出2 end name</code>。</li>
<li>除了可以用like ‘M%’判断字符串以M开头，还可以使用<code>left(字符串，location)</code>判断对应位置上的字母，例如<code>left(&#39;Mike&#39;,1)</code>。</li>
<li>同理可以用于其他情况如<code>update……set()</code>等</li>
</ul>
<h4 id="🙃source-1"><a href="#🙃source-1" class="headerlink" title="🙃source"></a>🙃source</h4><p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/calculate-special-bonus/">source</a></p>
<h2 id="张三的MySQL学习之路-一"><a href="#张三的MySQL学习之路-一" class="headerlink" title="张三的MySQL学习之路(一)"></a>张三的MySQL学习之路(一)</h2><p>2022-04-23</p>
<h4 id="🙈Introduction-2"><a href="#🙈Introduction-2" class="headerlink" title="🙈Introduction"></a>🙈Introduction</h4><p>描述</p>
<p>张三最近对 <code>MySQL</code> 数据库感兴趣，决定要好好学习数据库，但…学习的道路总是充满艰辛的。张三今天遇到了一个难题，他左思右想、苦思冥想、茶不思饭不想也没能想出解决办法。情况是这样的，现有 <code>teachers</code> 表中记录着离职的教师信息，<code>id</code> 的值即是教师离职的顺序，在 <code>courses</code> 表中记录着每个教师教授的课程信息，关联 id 为 <code>teacher_id</code>。<strong>现在知道教师是以国籍来分团队的，且每个团队的成立至少有 <code>3</code> 个教师，若是一个教师团队集体离职，则在 <code>teachers</code> 表中信息记录为连续且国籍相同，现在需要统计每一个教师团队集体离职会有多少学生需要等待新的教师，结果按团队国籍排序</strong>。他需要创建一个视图 <code>v_courses_teachers</code> 来解决这个问题，同学们快来帮帮张三小伙子吧 ~</p>
<h4 id="🤔code-2"><a href="#🤔code-2" class="headerlink" title="🤔code"></a>🤔code</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">view</span> v_courses_teachers <span class="keyword">as</span> (</span><br><span class="line">    <span class="keyword">select</span> tt.country,<span class="built_in">sum</span>(tt.student_count) student_count</span><br><span class="line">    <span class="keyword">from</span> (</span><br><span class="line">        <span class="keyword">select</span> <span class="keyword">distinct</span> t1.id,t1.country,c.student_count</span><br><span class="line">        <span class="keyword">from</span> teachers t1 <span class="keyword">left</span> <span class="keyword">join</span> teachers t2</span><br><span class="line">        <span class="keyword">on</span> t1.id<span class="operator">=</span>t2.id<span class="number">-1</span> <span class="keyword">or</span> t1.id<span class="operator">=</span>t2.id<span class="operator">+</span><span class="number">1</span></span><br><span class="line">        <span class="keyword">left</span> <span class="keyword">join</span> courses c <span class="keyword">on</span> t1.id<span class="operator">=</span>c.teacher_id</span><br><span class="line">        <span class="keyword">where</span> t1.country<span class="operator">=</span>t2.country</span><br><span class="line">    ) tt</span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> tt.country</span><br><span class="line">    <span class="keyword">having</span> <span class="built_in">count</span>(<span class="operator">*</span>)<span class="operator">&gt;</span><span class="number">2</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h4 id="💪get-2"><a href="#💪get-2" class="headerlink" title="💪get"></a>💪get</h4><ul>
<li>join是将表链接在源表后，<code>t1.id=t2.id-1 or t1.id=t2.id+1</code>会出现最多三行</li>
<li>group除了分组列，其他列可能包含多个值，容易BUG</li>
</ul>
<h4 id="🙃source-2"><a href="#🙃source-2" class="headerlink" title="🙃source"></a>🙃source</h4><p><a target="_blank" rel="noopener" href="https://www.lintcode.com/learn/130/664">source</a></p>
<h2 id="张三的MySQL学习之路（二）"><a href="#张三的MySQL学习之路（二）" class="headerlink" title="张三的MySQL学习之路（二）"></a>张三的MySQL学习之路（二）</h2><p>2022-04-23</p>
<h4 id="🙈Introduction-3"><a href="#🙈Introduction-3" class="headerlink" title="🙈Introduction"></a>🙈Introduction</h4><p>描述<br>张三曾经有一个梦想，想要听遍学校里的每一位教师的课程，于是写了一个视图 <code>v_mydream</code> 展示了所有的课程与授课教师的信息，并按教师姓名升序去实现，但是张三发现课程实在是太多太多，梦想需要改一改，于是他把梦想改成了去听<strong>每一位教师最受欢迎的课程（听课学生越多越受欢迎，如果该教师没有教授课程则课程与学生数显示为 <code>NULL</code>）</strong>，学校也非常支持他，听说他最近在学 <code>MySQL</code>，就给了他 <code>2</code> 张表的数据让他自己去找，<code>teachers</code> 表中记录着教师的信息，<code>courses</code> 表中记录着课程信息。张三一看，“ 哇~ 这也太简单了，感谢学校大大提供的数据 ”，可是他正要把原来的梦想视图改写，就发现李四从旁边过。李四肚子饿的呱呱叫，看到张三就问要不要一起去吃饭，张三灵光一闪，“ 这么巧~ 我也打算去吃饭，但是现在我这里有一个很简单的问题，你帮我解决了我就请你吃饭 ”，李四一听还有这等好事，立马答应下来了，结果发现不会。为了不掉面子并且能吃上一顿，就偷偷联系了你，请求你帮他解决。</p>
<h4 id="🤔code-3"><a href="#🤔code-3" class="headerlink" title="🤔code"></a>🤔code</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">view</span> v_mydream <span class="keyword">as</span></span><br><span class="line"><span class="keyword">select</span> teacher_name,course_name,student_count</span><br><span class="line"><span class="keyword">from</span>(</span><br><span class="line">     <span class="keyword">select</span> t.name teacher_name,c.name course_name,student_count,</span><br><span class="line">     <span class="built_in">rank</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> t.id <span class="keyword">order</span> <span class="keyword">by</span> student_count <span class="keyword">desc</span>) num</span><br><span class="line">     <span class="keyword">from</span> teachers t</span><br><span class="line">     <span class="keyword">left</span> <span class="keyword">join</span> courses c</span><br><span class="line">     <span class="keyword">on</span> t.id<span class="operator">=</span>c.teacher_id</span><br><span class="line">) tt</span><br><span class="line"><span class="keyword">where</span> tt.num<span class="operator">=</span><span class="number">1</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> teacher_name;</span><br></pre></td></tr></table></figure>
<h4 id="💪get-3"><a href="#💪get-3" class="headerlink" title="💪get"></a>💪get</h4><ol>
<li><code>DENSE_RANK()</code> 函数的语法如下：<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">DENSE_RANK</span>() <span class="keyword">OVER</span> (</span><br><span class="line">    <span class="keyword">PARTITION</span> <span class="keyword">BY</span> <span class="operator">&lt;</span>expression<span class="operator">&gt;</span>[&#123;,<span class="operator">&lt;</span>expression<span class="operator">&gt;</span>...&#125;]</span><br><span class="line">    <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="operator">&lt;</span>expression<span class="operator">&gt;</span> [<span class="keyword">ASC</span><span class="operator">|</span><span class="keyword">DESC</span>], [&#123;,<span class="operator">&lt;</span>expression<span class="operator">&gt;</span>...&#125;]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
在这个语法中：</li>
</ol>
<ul>
<li>首先，<code>PARTITION BY</code>子句将<code>FROM</code>子句生成的结果集划分为分区。<code>DENSE_RANK()</code>函数应用于每个分区。</li>
<li>其次，<code>ORDER BY</code>  子句指定<code>DENSE_RANK()</code>函数操作的每个分区中的行顺序。<br>如果分区具有两个或更多具有相同排名值的行，则将为这些行中的每一行分配相同的排名。<br>与<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/133469603#:~:text=%E5%85%88%E4%B8%8A%E7%BB%93%E8%AE%BA%EF%BC%8C%E4%B8%89%E8%80%85%E7%9A%84%E5%8C%BA%E5%88%AB%E5%A6%82%E4%B8%8B%EF%BC%9A%20rank,%28%29%E6%8E%92%E5%BA%8F%E7%9B%B8%E5%90%8C%E6%97%B6%E4%BC%9A%E9%87%8D%E5%A4%8D%EF%BC%8C%E6%80%BB%E6%95%B0%E4%B8%8D%E5%8F%98%EF%BC%8C%E5%8D%B3%E4%BC%9A%E5%87%BA%E7%8E%B01%E3%80%811%E3%80%813%E8%BF%99%E6%A0%B7%E7%9A%84%E6%8E%92%E5%BA%8F%E7%BB%93%E6%9E%9C%EF%BC%9B%20dense_rank%20%28%29%E6%8E%92%E5%BA%8F%E7%9B%B8%E5%90%8C%E6%97%B6%E4%BC%9A%E9%87%8D%E5%A4%8D%EF%BC%8C%E6%80%BB%E6%95%B0%E4%BC%9A%E5%87%8F%E5%B0%91%EF%BC%8C%E5%8D%B3%E4%BC%9A%E5%87%BA%E7%8E%B01%E3%80%811%E3%80%812%E8%BF%99%E6%A0%B7%E7%9A%84%E6%8E%92%E5%BA%8F%E7%BB%93%E6%9E%9C%EF%BC%9B">Rank</a><code>函数不同，</code>DENSE_RANK()`函数始终返回连续的排名值。<br>eee<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> sales;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+-------------+--------+</span></span><br><span class="line"><span class="operator">|</span> sales_employee <span class="operator">|</span> fiscal_year <span class="operator">|</span> sale   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+-------------+--------+</span></span><br><span class="line"><span class="operator">|</span> Alice          <span class="operator">|</span>        <span class="number">2016</span> <span class="operator">|</span> <span class="number">150.00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Alice          <span class="operator">|</span>        <span class="number">2017</span> <span class="operator">|</span> <span class="number">100.00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Alice          <span class="operator">|</span>        <span class="number">2018</span> <span class="operator">|</span> <span class="number">200.00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Bob            <span class="operator">|</span>        <span class="number">2016</span> <span class="operator">|</span> <span class="number">100.00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Bob            <span class="operator">|</span>        <span class="number">2017</span> <span class="operator">|</span> <span class="number">150.00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Bob            <span class="operator">|</span>        <span class="number">2018</span> <span class="operator">|</span> <span class="number">200.00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> John           <span class="operator">|</span>        <span class="number">2016</span> <span class="operator">|</span> <span class="number">200.00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> John           <span class="operator">|</span>        <span class="number">2017</span> <span class="operator">|</span> <span class="number">150.00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> John           <span class="operator">|</span>        <span class="number">2018</span> <span class="operator">|</span> <span class="number">250.00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+-------------+--------+</span></span><br><span class="line"><span class="number">9</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    sales_employee,</span><br><span class="line">    fiscal_year,</span><br><span class="line">    sale,</span><br><span class="line">    <span class="built_in">DENSE_RANK</span>() <span class="keyword">OVER</span> (<span class="keyword">PARTITION</span> <span class="keyword">BY</span></span><br><span class="line">                     fiscal_year</span><br><span class="line">                 <span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">                     sale <span class="keyword">DESC</span></span><br><span class="line">                ) sales_rank</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    sales;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">----------------+-------------+--------+------------+</span></span><br><span class="line"><span class="operator">|</span> sales_employee <span class="operator">|</span> fiscal_year <span class="operator">|</span> sale   <span class="operator">|</span> sales_rank <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+-------------+--------+------------+</span></span><br><span class="line"><span class="operator">|</span> John           <span class="operator">|</span>        <span class="number">2016</span> <span class="operator">|</span> <span class="number">200.00</span> <span class="operator">|</span>          <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Alice          <span class="operator">|</span>        <span class="number">2016</span> <span class="operator">|</span> <span class="number">150.00</span> <span class="operator">|</span>          <span class="number">2</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Bob            <span class="operator">|</span>        <span class="number">2016</span> <span class="operator">|</span> <span class="number">100.00</span> <span class="operator">|</span>          <span class="number">3</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Bob            <span class="operator">|</span>        <span class="number">2017</span> <span class="operator">|</span> <span class="number">150.00</span> <span class="operator">|</span>          <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> John           <span class="operator">|</span>        <span class="number">2017</span> <span class="operator">|</span> <span class="number">150.00</span> <span class="operator">|</span>          <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Alice          <span class="operator">|</span>        <span class="number">2017</span> <span class="operator">|</span> <span class="number">100.00</span> <span class="operator">|</span>          <span class="number">2</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> John           <span class="operator">|</span>        <span class="number">2018</span> <span class="operator">|</span> <span class="number">250.00</span> <span class="operator">|</span>          <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Alice          <span class="operator">|</span>        <span class="number">2018</span> <span class="operator">|</span> <span class="number">200.00</span> <span class="operator">|</span>          <span class="number">2</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Bob            <span class="operator">|</span>        <span class="number">2018</span> <span class="operator">|</span> <span class="number">200.00</span> <span class="operator">|</span>          <span class="number">2</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+-------------+--------+------------+</span></span><br><span class="line"><span class="number">9</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure>
<p>在这个例子中：</p>
<ul>
<li>首先，<code>PARTITION BY</code>子句使用会计年度将结果集划分为分区。</li>
<li>其次，<code>ORDER BY</code>条款按销售额的降序指定了销售员工的顺序。</li>
<li>第三，<code>DENSE_RANK()</code>函数应用于具有<code>ORDER BY</code>子句指定的行顺序的每个分区。</li>
</ul>
<p><code>rank()/dense_rank()/row_number()的区别：</code></p>
<ul>
<li>rank()排序相同时会重复，总数不变，即会出现1、1、3这样的排序结果；</li>
<li>dense_rank()排序相同时会重复，总数会减少，即会出现1、1、2这样的排序结果；</li>
<li>row_number()排序相同时不会重复，会根据顺序排序。<h4 id="🙃source-3"><a href="#🙃source-3" class="headerlink" title="🙃source"></a>🙃source</h4><a target="_blank" rel="noopener" href="https://www.lintcode.com/learn/132/668">source</a><br><a target="_blank" rel="noopener" href="https://www.begtut.com/mysql/mysql-dense_rank-function.html">DENSE_RANK</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_44690947/article/details/109133592">max()与group by()</a></li>
</ul>
<h2 id="修复表中的名字"><a href="#修复表中的名字" class="headerlink" title="修复表中的名字"></a>修复表中的名字</h2><p>2022-04-24</p>
<h4 id="🙈Introduction-4"><a href="#🙈Introduction-4" class="headerlink" title="🙈Introduction"></a>🙈Introduction</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">----------------+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">Column</span> Name    <span class="operator">|</span> Type    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+---------+</span></span><br><span class="line"><span class="operator">|</span> user_id        <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> name           <span class="operator">|</span> <span class="type">varchar</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+---------+</span></span><br><span class="line">user_id 是该表的主键。</span><br><span class="line">该表包含用户的 ID 和名字。名字仅由小写和大写字符组成。</span><br></pre></td></tr></table></figure>
<p>编写一个 SQL 查询来修复名字，使得只有第一个字符是大写的，其余都是小写的。</p>
<p>返回按 <code>user_id</code> 排序的结果表。</p>
<h4 id="🤔code-4"><a href="#🤔code-4" class="headerlink" title="🤔code"></a>🤔code</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> user_id,concat(<span class="built_in">upper</span>(<span class="keyword">left</span>(name,<span class="number">1</span>)),<span class="built_in">lower</span>(substr(name,<span class="number">2</span>))) name</span><br><span class="line"><span class="keyword">from</span> Users</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> user_id;</span><br></pre></td></tr></table></figure>
<h4 id="💪get-4"><a href="#💪get-4" class="headerlink" title="💪get"></a>💪get</h4><ul>
<li>字符串处理函数<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> concat(<span class="string">&#x27;My&#x27;</span>,<span class="string">&#x27;S&#x27;</span>,<span class="string">&#x27;QL&#x27;</span>)</span><br><span class="line"><span class="comment">--&#x27;MySQL&#x27;</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">left</span>(<span class="string">&#x27;foobarbar&#x27;</span>,<span class="number">5</span>)</span><br><span class="line"><span class="comment">--&#x27;fooba&#x27;</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">lower</span>(<span class="string">&#x27;QUADRATICALLY&#x27;</span>)</span><br><span class="line"><span class="comment">--&#x27;quadratically&#x27;</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">substring</span>(<span class="string">&#x27;Quadratically&#x27;</span>,<span class="number">5</span>)</span><br><span class="line"><span class="comment">--&#x27;ratically&#x27;</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">upper</span>(<span class="string">&#x27;Hej&#x27;</span>)</span><br><span class="line"><span class="comment">--&#x27;HEJ&#x27;</span></span><br></pre></td></tr></table></figure>
<h4 id="🙃source-4"><a href="#🙃source-4" class="headerlink" title="🙃source"></a>🙃source</h4><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/fix-names-in-a-table/">source</a><h2 id="患某种疾病的患者"><a href="#患某种疾病的患者" class="headerlink" title="患某种疾病的患者"></a>患某种疾病的患者</h2>2022-04-24</li>
</ul>
<h4 id="🙈Introduction-5"><a href="#🙈Introduction-5" class="headerlink" title="🙈Introduction"></a>🙈Introduction</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">--------------+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">Column</span> Name  <span class="operator">|</span> Type    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------+---------+</span></span><br><span class="line"><span class="operator">|</span> patient_id   <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> patient_name <span class="operator">|</span> <span class="type">varchar</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> conditions   <span class="operator">|</span> <span class="type">varchar</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------+---------+</span></span><br><span class="line">patient_id （患者 ID）是该表的主键。</span><br><span class="line"><span class="string">&#x27;conditions&#x27;</span> （疾病）包含 <span class="number">0</span> 个或以上的疾病代码，以空格分隔。</span><br><span class="line">这个表包含医院中患者的信息。</span><br></pre></td></tr></table></figure>
<p>写一条 SQL 语句，查询患有 I 类糖尿病的患者 ID （patient_id）、患者姓名（patient_name）以及其患有的所有疾病代码（conditions）。I 类糖尿病的代码总是包含前缀 DIAB1 。</p>
<p>按 任意顺序 返回结果表。</p>
<h4 id="🤔code-5"><a href="#🤔code-5" class="headerlink" title="🤔code"></a>🤔code</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> patient_id,patient_name,conditions</span><br><span class="line"><span class="keyword">from</span> Patients</span><br><span class="line"><span class="keyword">where</span> conditions <span class="keyword">like</span> <span class="string">&#x27;DIAB1%&#x27;</span> <span class="keyword">or</span> conditions <span class="keyword">like</span> <span class="string">&#x27;% DIAB1%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h4 id="💪get-5"><a href="#💪get-5" class="headerlink" title="💪get"></a>💪get</h4><ul>
<li>多条件[[sql条件运算#使用LIKE模糊查询|like]]:<code>where conditions like &#39;condition1&#39; or/and conditions like &#39;condition2&#39;</code></li>
<li><code>%</code>匹配：<code>%con</code>以con开头，<code>% con</code>以 con开头<h4 id="🙃source-5"><a href="#🙃source-5" class="headerlink" title="🙃source"></a>🙃source</h4><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/patients-with-a-condition/">source</a><h2 id="按日期分组销售产品"><a href="#按日期分组销售产品" class="headerlink" title="按日期分组销售产品"></a>按日期分组销售产品</h2>2022-04-24</li>
</ul>
<h4 id="🙈Introduction-6"><a href="#🙈Introduction-6" class="headerlink" title="🙈Introduction"></a>🙈Introduction</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">-------------+---------+</span></span><br><span class="line"><span class="operator">|</span> 列名         <span class="operator">|</span> 类型    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+---------+</span></span><br><span class="line"><span class="operator">|</span> sell_date   <span class="operator">|</span> <span class="type">date</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> product     <span class="operator">|</span> <span class="type">varchar</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+---------+</span></span><br><span class="line">此表没有主键，它可能包含重复项。</span><br><span class="line">此表的每一行都包含产品名称和在市场上销售的日期。</span><br></pre></td></tr></table></figure>
<p>编写一个 SQL 查询来查找每个日期、销售的不同产品的数量及其名称。<br>每个日期的销售产品名称应按词典序排列。<br>返回按 sell_date 排序的结果表。<br>查询结果格式如下例所示。</p>
<h4 id="🤔code-6"><a href="#🤔code-6" class="headerlink" title="🤔code"></a>🤔code</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> sell_date,<span class="built_in">count</span>(<span class="keyword">distinct</span> product) num_sold,group_concat(<span class="keyword">distinct</span> product) products</span><br><span class="line"><span class="keyword">from</span> Activities</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> sell_date</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> sell_date <span class="keyword">asc</span>;</span><br></pre></td></tr></table></figure>
<h4 id="💪get-6"><a href="#💪get-6" class="headerlink" title="💪get"></a>💪get</h4><ul>
<li>[[函数#使用 COUNT 函数计数|count()]]聚合函数搭配<code>group</code>使用，实现分组计数。</li>
<li><code>group_concat</code>对分组内容进行拼接，若不拼接直接输出为第一个值。<br>concat和group_concat的区别：</li>
</ul>
<ol>
<li>concat是针对以行数据做的拼接，而group_concat是针对列做的数据拼接，且group_concat自动生成逗号。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--concat</span></span><br><span class="line"><span class="keyword">select</span> concat(id, &quot;,&quot;, classId) <span class="keyword">from</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="comment">--group_concat</span></span><br><span class="line"><span class="comment">--一般与group by结合使用</span></span><br><span class="line"><span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">group</span> <span class="keyword">by</span> classId;</span><br></pre></td></tr></table></figure>
<h4 id="🙃source-6"><a href="#🙃source-6" class="headerlink" title="🙃source"></a>🙃source</h4><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/group-sold-products-by-the-date/">source</a><h2 id="张三的-MySQL-学习之路（四"><a href="#张三的-MySQL-学习之路（四" class="headerlink" title="张三的 MySQL 学习之路（四"></a>张三的 MySQL 学习之路（四</h2>2022-04-24</li>
</ol>
<h4 id="🙈Introduction-7"><a href="#🙈Introduction-7" class="headerlink" title="🙈Introduction"></a>🙈Introduction</h4><p>描述<br>“今晚的月色真美啊~ ”，张三一个人在赏月，这美妙的时刻也只有在学习结束后才能感受到，今天张三刚开始学存储过程，他发现这是一个好东西啊，学完之后再赏个月真是美滋滋。这时候，某教师给他打了一个电话，直接就毁了他这个美妙的夜晚。某教师说帮他整个活，系里现在准备年轻化、活力化教师团队，<strong>上多门课（至少 2 门课）的教师就是活跃教师</strong>，但是现在教师中有些年轻人啊喜欢偷懒，只上 1 门课或是不上课，于是要<strong>将活跃教师中年龄最大的教师所教授的课程全部交给不活跃教师中最年轻的教师（如果年龄相同就按姓名顺序），直到整个教师团队显得更年轻化、活力化，而这个标准就是活跃教师的平均年龄要求不能大于全体教师的平均年龄</strong>，而且这个工作会定期做的，由于业务繁忙，然后丢给张三 2 张表让张三帮他做，<code>teachers</code> 表记录着教师的信息，和 <code>courses</code> 表记录着课程信息，关联 <code>id</code> 为 <code>teacher_id</code>。张三本不想接这个活，但是突然灵光一闪就答应了，谈妥条件以后，张三回头就用存储过程给他写出来了并且不告诉某教师。教师听说张三并不是手动给他做的，于是想要挖出张三是怎么做的，通过打听只知道是用了存储过程，作为教师，我当然要自己写了，怎么能让张三那小子拿好处？小伙子，快来复现一下这个存储过程吧</p>
<h4 id="🤔code-7"><a href="#🤔code-7" class="headerlink" title="🤔code"></a>🤔code</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> youngTeachers ()</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">     <span class="keyword">declare</span> oldt <span class="type">int</span> <span class="keyword">default</span> <span class="number">0</span>;<span class="comment">--最大年龄教师</span></span><br><span class="line">     <span class="keyword">declare</span> tid <span class="type">int</span> <span class="keyword">default</span> <span class="number">0</span>;<span class="comment">--不活跃且最年轻</span></span><br><span class="line">     <span class="keyword">declare</span> actnum <span class="type">int</span> <span class="keyword">default</span> <span class="number">0</span>;<span class="comment">--活跃的平均年龄</span></span><br><span class="line">     <span class="keyword">declare</span> notactnum <span class="type">int</span> <span class="keyword">default</span> <span class="number">0</span>;<span class="comment">--平均年龄</span></span><br><span class="line">     loop1:loop</span><br><span class="line">          <span class="comment">--活跃教师的平均年龄</span></span><br><span class="line">          <span class="keyword">select</span> <span class="built_in">avg</span>(age) <span class="keyword">into</span> actnum <span class="keyword">from</span> teachers t</span><br><span class="line">          <span class="keyword">left</span> <span class="keyword">join</span> (<span class="keyword">select</span> teacher_id,<span class="built_in">count</span>(<span class="operator">*</span>) num <span class="keyword">from</span> courses <span class="keyword">group</span> <span class="keyword">by</span> teacher_id) <span class="keyword">as</span> c</span><br><span class="line">          <span class="keyword">on</span> t.id<span class="operator">=</span>c.teacher_id</span><br><span class="line">          <span class="keyword">where</span> c.num<span class="operator">&gt;</span><span class="number">1</span>;</span><br><span class="line">          <span class="comment">--所有老师的平均年龄</span></span><br><span class="line">          <span class="keyword">select</span> <span class="built_in">avg</span>(age) <span class="keyword">into</span> notactnum <span class="keyword">from</span> teachers;</span><br><span class="line">          <span class="comment">--判断年龄是否符合要求</span></span><br><span class="line">          if actnum<span class="operator">&lt;=</span>notactnum <span class="keyword">then</span></span><br><span class="line">               leave loop1;</span><br><span class="line">          <span class="keyword">end</span> if;</span><br><span class="line">          <span class="comment">--找出年龄最大的老师</span></span><br><span class="line">          <span class="keyword">select</span> t.id <span class="keyword">into</span> oldt <span class="keyword">from</span> (<span class="keyword">select</span> teacher_id,<span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> num <span class="keyword">from</span> courses <span class="keyword">group</span> <span class="keyword">by</span> teacher_id) <span class="keyword">as</span> c</span><br><span class="line">          <span class="keyword">left</span> <span class="keyword">join</span> teachers t</span><br><span class="line">          <span class="keyword">on</span> t.id<span class="operator">=</span>c.teacher_id</span><br><span class="line">          <span class="keyword">where</span> c.num<span class="operator">&gt;</span><span class="number">1</span></span><br><span class="line">          <span class="keyword">order</span> <span class="keyword">by</span> t.age <span class="keyword">desc</span></span><br><span class="line">          limit <span class="number">1</span>;</span><br><span class="line">          <span class="comment">--找出不活跃教师中最年轻的老师</span></span><br><span class="line">          <span class="keyword">select</span> t.id <span class="keyword">into</span> tid</span><br><span class="line">          <span class="keyword">from</span> teachers t</span><br><span class="line">          <span class="keyword">left</span> <span class="keyword">join</span> (<span class="keyword">select</span> teacher_id,<span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> num <span class="keyword">from</span> courses <span class="keyword">group</span> <span class="keyword">by</span> teacher_id) <span class="keyword">as</span> c</span><br><span class="line">          <span class="keyword">on</span> t.id<span class="operator">=</span>c.teacher_id</span><br><span class="line">          <span class="keyword">where</span> c.num<span class="operator">&lt;=</span><span class="number">1</span> <span class="keyword">or</span> c.num <span class="keyword">is</span> <span class="keyword">null</span></span><br><span class="line">          <span class="keyword">order</span> <span class="keyword">by</span> age <span class="keyword">asc</span>,t.name <span class="keyword">asc</span></span><br><span class="line">          limit <span class="number">1</span>;</span><br><span class="line">          <span class="comment">--更新数据</span></span><br><span class="line">          <span class="keyword">update</span> courses</span><br><span class="line">          <span class="keyword">set</span> teacher_id<span class="operator">=</span>tid <span class="keyword">where</span> teacher_id<span class="operator">=</span>oldt;</span><br><span class="line">     <span class="keyword">end</span> loop;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">call</span> youngTeachers();</span><br></pre></td></tr></table></figure>
<h4 id="💪get-7"><a href="#💪get-7" class="headerlink" title="💪get"></a>💪get</h4><ul>
<li>[[存储过程]]</li>
<li>sql循环过程![[存储过程#循环语句]]</li>
</ul>
<h4 id="🙃source-7"><a href="#🙃source-7" class="headerlink" title="🙃source"></a>🙃source</h4><p><a target="_blank" rel="noopener" href="https://www.lintcode.com/problem/2800/description">source</a></p>
<h2 id="丢失信息的雇员"><a href="#丢失信息的雇员" class="headerlink" title="丢失信息的雇员"></a>丢失信息的雇员</h2><p>2022-04-25</p>
<h4 id="🙈Introduction-8"><a href="#🙈Introduction-8" class="headerlink" title="🙈Introduction"></a>🙈Introduction</h4><p>表: <code>Employees</code><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">-------------+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">Column</span> Name <span class="operator">|</span> Type    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+---------+</span></span><br><span class="line"><span class="operator">|</span> employee_id <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> name        <span class="operator">|</span> <span class="type">varchar</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+---------+</span></span><br><span class="line">employee_id 是这个表的主键。</span><br><span class="line">每一行表示雇员的id 和他的姓名。</span><br></pre></td></tr></table></figure><br>表: <code>Salaries</code><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">-------------+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">Column</span> Name <span class="operator">|</span> Type    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+---------+</span></span><br><span class="line"><span class="operator">|</span> employee_id <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> salary      <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+---------+</span></span><br><span class="line">employee_id <span class="keyword">is</span> 这个表的主键。</span><br><span class="line">每一行表示雇员的id 和他的薪水。</span><br></pre></td></tr></table></figure></p>
<p>写出一个查询语句，找到所有 丢失信息 的雇员id。当满足下面一个条件时，就被认为是雇员的信息丢失：</p>
<pre><code>雇员的 姓名 丢失了，或者
雇员的 薪水信息 丢失了，或者
</code></pre><p>返回这些雇员的id  employee_id ， 从小到大排序 。</p>
<h4 id="🤔code-8"><a href="#🤔code-8" class="headerlink" title="🤔code"></a>🤔code</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--first version</span></span><br><span class="line"><span class="keyword">select</span> ee.employee_id <span class="keyword">from</span>(</span><br><span class="line">    <span class="keyword">select</span> e.employee_id </span><br><span class="line">        <span class="keyword">from</span> Employees e </span><br><span class="line">            <span class="keyword">left</span> <span class="keyword">join</span> Salaries s </span><br><span class="line">            <span class="keyword">on</span> e.employee_id<span class="operator">=</span>s.employee_id</span><br><span class="line">    <span class="keyword">union</span></span><br><span class="line">    <span class="keyword">select</span> s.employee_id </span><br><span class="line">        <span class="keyword">from</span> Employees e </span><br><span class="line">            <span class="keyword">right</span> <span class="keyword">join</span> Salaries s </span><br><span class="line">            <span class="keyword">on</span> e.employee_id<span class="operator">=</span>s.employee_id</span><br><span class="line"></span><br><span class="line">) ee</span><br><span class="line"><span class="keyword">where</span> ee.employee_id <span class="keyword">not</span> <span class="keyword">in</span>(<span class="keyword">select</span> employee_id <span class="keyword">from</span> Employees) <span class="keyword">or</span> ee.employee_id <span class="keyword">not</span> <span class="keyword">in</span> (<span class="keyword">select</span> employee_id <span class="keyword">from</span> Salaries) </span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> ee.employee_id;</span><br><span class="line"><span class="comment">------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> employee_id <span class="keyword">from</span> employees</span><br><span class="line"><span class="keyword">where</span> employee_id <span class="keyword">not</span> <span class="keyword">in</span> (<span class="keyword">select</span> employee_id <span class="keyword">from</span> salaries)</span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> employee_id <span class="keyword">from</span> salaries</span><br><span class="line"><span class="keyword">where</span> employee_id <span class="keyword">not</span> <span class="keyword">in</span> (<span class="keyword">select</span> employee_id <span class="keyword">from</span> employees)</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> employee_id</span><br><span class="line"></span><br><span class="line"><span class="comment">--second version</span></span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">    employee_id </span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">    (</span><br><span class="line">    <span class="keyword">select</span> employee_id <span class="keyword">from</span> employees</span><br><span class="line">    <span class="keyword">union</span> <span class="keyword">all</span> </span><br><span class="line">    <span class="keyword">select</span> employee_id <span class="keyword">from</span> salaries</span><br><span class="line">) <span class="keyword">as</span> t</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> </span><br><span class="line">    employee_id</span><br><span class="line"><span class="keyword">having</span> </span><br><span class="line">    <span class="built_in">count</span>(employee_id) <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> </span><br><span class="line">    employee_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> tmp <span class="keyword">as</span>(</span><br><span class="line">    <span class="keyword">select</span> employee_id <span class="keyword">from</span> employees </span><br><span class="line">    <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">    <span class="keyword">select</span> employee_id <span class="keyword">from</span> salaries</span><br><span class="line">)</span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">employee_id</span><br><span class="line"><span class="keyword">from</span> tmp t <span class="keyword">group</span> <span class="keyword">by</span> <span class="number">1</span> <span class="keyword">having</span> <span class="built_in">count</span>(<span class="number">1</span>)<span class="operator">=</span><span class="number">1</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>
<h4 id="💪get-8"><a href="#💪get-8" class="headerlink" title="💪get"></a>💪get</h4><ul>
<li><code>union和union all</code>:<blockquote>
<p><strong>Union:对两个结果集进行并集操作，不包括重复行，同时进行默认规则的排序；</strong><br> UNION在进行表链接后会<code>筛选掉重复的记录</code>，所以在表链接后会对所产生的结果集进行排序运算，删除重复的记录再返回结果。<br> <strong>Union All：对两个结果集进行并集操作，<code>包括重复行，不进行排序</code>；</strong></p>
</blockquote>
</li>
<li>[[联结#外连接 OUTER JOIN|全外连接]]：<code>a left join b union a right join b on ……</code>。左侧为a表，右侧为b表，b中有a中没有的填充null。<h4 id="🙃source-8"><a href="#🙃source-8" class="headerlink" title="🙃source"></a>🙃source</h4><a href="">source</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/u010931123/article/details/82425580">union/union all</a><h2 id="每个产品在不同商店的价格"><a href="#每个产品在不同商店的价格" class="headerlink" title="每个产品在不同商店的价格"></a>每个产品在不同商店的价格</h2>2022-04-25</li>
</ul>
<h4 id="🙈Introduction-9"><a href="#🙈Introduction-9" class="headerlink" title="🙈Introduction"></a>🙈Introduction</h4><p>表：<code>Products</code><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">-------------+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">Column</span> Name <span class="operator">|</span> Type    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+---------+</span></span><br><span class="line"><span class="operator">|</span> product_id  <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> store1      <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> store2      <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> store3      <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+---------+</span></span><br><span class="line">这张表的主键是product_id（产品Id）。</span><br><span class="line">每行存储了这一产品在不同商店store1, store2, store3的价格。</span><br><span class="line">如果这一产品在商店里没有出售，则值将为<span class="keyword">null</span>。</span><br></pre></td></tr></table></figure><br>请你重构 Products 表，查询每个产品在不同商店的价格，使得输出的格式变为(product_id, store, price) 。如果这一产品在商店里没有出售，则不输出这一行。</p>
<p>输出结果表中的 顺序不作要求 。</p>
<h4 id="🤔code-9"><a href="#🤔code-9" class="headerlink" title="🤔code"></a>🤔code</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> product_id,store,price <span class="keyword">from</span>(</span><br><span class="line"></span><br><span class="line">    <span class="keyword">select</span> product_id,<span class="string">&#x27;store1&#x27;</span> store,store1 price <span class="keyword">from</span> Products</span><br><span class="line">    <span class="comment">--where store1 is not null</span></span><br><span class="line">    <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">    <span class="keyword">select</span> product_id,<span class="string">&#x27;store2&#x27;</span> store,store2 price <span class="keyword">from</span> Products</span><br><span class="line">    <span class="comment">--where store2 is not null</span></span><br><span class="line">    <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">    <span class="keyword">select</span> product_id,<span class="string">&#x27;store3&#x27;</span> store,store3 price <span class="keyword">from</span> Products</span><br><span class="line">    <span class="comment">--where store3 is not null</span></span><br><span class="line">) ee</span><br><span class="line"><span class="keyword">where</span> price <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span>;</span><br></pre></td></tr></table></figure>
<h4 id="💪get-9"><a href="#💪get-9" class="headerlink" title="💪get"></a>💪get</h4><ul>
<li>设置常量列<code>select &#39;a&#39; coloum</code></li>
<li>行转列常用<code>case when</code>和<code>union all</code><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://pic.leetcode-cn.com/1627441221-KvsJUP-%E6%9C%AA%E5%91%BD%E5%90%8D%E5%9B%BE%E7%89%87.png" alt="object"></li>
</ul>
<p><strong>行转列——MAX/SUM+CASE WHEN+GROUP BY</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name,</span><br><span class="line">  <span class="built_in">MAX</span>(<span class="keyword">CASE</span> <span class="keyword">WHEN</span> subject<span class="operator">=</span><span class="string">&#x27;语文&#x27;</span> <span class="keyword">THEN</span> score <span class="keyword">ELSE</span> <span class="number">0</span> <span class="keyword">END</span>) <span class="keyword">AS</span> &quot;语文&quot;,</span><br><span class="line">  <span class="built_in">MAX</span>(<span class="keyword">CASE</span> <span class="keyword">WHEN</span> subject<span class="operator">=</span><span class="string">&#x27;数学&#x27;</span> <span class="keyword">THEN</span> score <span class="keyword">ELSE</span> <span class="number">0</span> <span class="keyword">END</span>) <span class="keyword">AS</span> &quot;数学&quot;,</span><br><span class="line">  <span class="built_in">MAX</span>(<span class="keyword">CASE</span> <span class="keyword">WHEN</span> subject<span class="operator">=</span><span class="string">&#x27;英语&#x27;</span> <span class="keyword">THEN</span> score <span class="keyword">ELSE</span> <span class="number">0</span> <span class="keyword">END</span>) <span class="keyword">AS</span> &quot;英语&quot;</span><br><span class="line"><span class="keyword">FROM</span> student1</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> name</span><br></pre></td></tr></table></figure></p>
<p><strong>列转行——MAX+UNION+GROUP BY</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> NAME,<span class="string">&#x27;语文&#x27;</span> <span class="keyword">AS</span> subject,<span class="built_in">MAX</span>(&quot;语文&quot;) <span class="keyword">AS</span> score</span><br><span class="line"><span class="keyword">FROM</span> student2 <span class="keyword">GROUP</span> <span class="keyword">BY</span> NAME</span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> NAME,<span class="string">&#x27;数学&#x27;</span> <span class="keyword">AS</span> subject,<span class="built_in">MAX</span>(&quot;数学&quot;) <span class="keyword">AS</span> score</span><br><span class="line"><span class="keyword">FROM</span> student2 <span class="keyword">GROUP</span> <span class="keyword">BY</span> NAME</span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> NAME,<span class="string">&#x27;英语&#x27;</span> <span class="keyword">AS</span> subject,<span class="built_in">MAX</span>(&quot;英语&quot;) <span class="keyword">AS</span> score</span><br><span class="line"><span class="keyword">FROM</span> student2 <span class="keyword">GROUP</span> <span class="keyword">BY</span> NAME</span><br></pre></td></tr></table></figure></p>
<h4 id="🙃source-9"><a href="#🙃source-9" class="headerlink" title="🙃source"></a>🙃source</h4><p><a href="">source</a></p>
<h2 id="树节点"><a href="#树节点" class="headerlink" title="树节点"></a>树节点</h2><p>2022-04-25</p>
<h4 id="🙈Introduction-10"><a href="#🙈Introduction-10" class="headerlink" title="🙈Introduction"></a>🙈Introduction</h4><p>给定一个表 <code>tree</code>，<strong>id</strong> 是树节点的编号， <strong>p_id</strong> 是它父节点的 <strong>id 。</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">----+------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> p_id <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span>  <span class="operator">|</span> <span class="keyword">null</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2</span>  <span class="operator">|</span> <span class="number">1</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3</span>  <span class="operator">|</span> <span class="number">1</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">4</span>  <span class="operator">|</span> <span class="number">2</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">5</span>  <span class="operator">|</span> <span class="number">2</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+</span></span><br></pre></td></tr></table></figure><br>树中每个节点属于以下三种类型之一：</p>
<pre><code>叶子：如果这个节点没有任何孩子节点。
根：如果这个节点是整棵树的根，即没有父节点。
内部节点：如果这个节点既不是叶子节点也不是根节点。
</code></pre><p>写一个查询语句，输出所有节点的编号和节点的类型，并将结果按照节点编号排序。上面样例的结果为：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">----+------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> Type <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span>  <span class="operator">|</span> Root <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2</span>  <span class="operator">|</span> <span class="keyword">Inner</span><span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3</span>  <span class="operator">|</span> Leaf <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">4</span>  <span class="operator">|</span> Leaf <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">5</span>  <span class="operator">|</span> Leaf <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+</span></span><br></pre></td></tr></table></figure></p>
<h4 id="🤔code-10"><a href="#🤔code-10" class="headerlink" title="🤔code"></a>🤔code</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--first version</span></span><br><span class="line"><span class="keyword">select</span> id,Type <span class="keyword">from</span> (</span><br><span class="line">    <span class="keyword">select</span> id,<span class="string">&#x27;Root&#x27;</span> type <span class="keyword">from</span> tree <span class="keyword">where</span> p_id <span class="keyword">is</span> <span class="keyword">null</span></span><br><span class="line">    <span class="keyword">union</span></span><br><span class="line">    <span class="keyword">select</span> id,<span class="string">&#x27;Inner&#x27;</span> type <span class="keyword">from</span> tree <span class="keyword">where</span> id <span class="keyword">in</span> (<span class="keyword">select</span> p_id <span class="keyword">from</span> tree <span class="keyword">where</span> p_id <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">and</span> p_id<span class="operator">!=</span>(<span class="keyword">select</span> id <span class="keyword">from</span> tree <span class="keyword">where</span> p_id <span class="keyword">is</span> <span class="keyword">null</span>))</span><br><span class="line">    <span class="keyword">union</span></span><br><span class="line">    <span class="keyword">select</span> id,<span class="string">&#x27;Leaf&#x27;</span> type <span class="keyword">from</span> tree <span class="keyword">where</span> id <span class="keyword">not</span> <span class="keyword">in</span> (<span class="keyword">select</span> p_id <span class="keyword">from</span> tree <span class="keyword">where</span> p_id <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span>)</span><br><span class="line">) ee</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> id</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> id;</span><br><span class="line"><span class="comment">--answer</span></span><br><span class="line"># 根结点: 没有父节点</span><br><span class="line"><span class="keyword">SELECT</span> ID, <span class="string">&#x27;Root&#x27;</span> <span class="keyword">AS</span> TYPE </span><br><span class="line"><span class="keyword">FROM</span> TREE <span class="keyword">AS</span> T </span><br><span class="line"><span class="keyword">WHERE</span> P_ID <span class="keyword">IS</span> <span class="keyword">NULL</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"># 中间节点: 担任父节点 并且 不是根节点</span><br><span class="line"><span class="keyword">SELECT</span> ID, <span class="string">&#x27;Inner&#x27;</span> <span class="keyword">AS</span> TYPE</span><br><span class="line"><span class="keyword">FROM</span> TREE <span class="keyword">AS</span> T </span><br><span class="line"><span class="keyword">WHERE</span> </span><br><span class="line">ID <span class="keyword">IN</span> (<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> P_ID <span class="keyword">FROM</span> TREE <span class="keyword">WHERE</span> P_ID <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>)</span><br><span class="line"><span class="keyword">AND</span></span><br><span class="line">(P_ID <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"># 叶子结点: 不担任父节点 并且 不是根节点</span><br><span class="line"># 注意:这里还需限制“不是根节点” 是因为当树只有一个节点的时候 根节点也不担任父节点 </span><br><span class="line"># 注意:ID <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> P_ID <span class="keyword">FROM</span> TREE <span class="keyword">WHERE</span> P_ID <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>)里面要限制P_ID <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line"># 否则<span class="keyword">SELECT</span>出来的结果里面有<span class="keyword">NULL</span> 这句话返回空列表 (我也不太明白为什么)</span><br><span class="line"><span class="keyword">SELECT</span> ID, <span class="string">&#x27;Leaf&#x27;</span> <span class="keyword">AS</span> TYPE</span><br><span class="line"><span class="keyword">FROM</span> TREE <span class="keyword">AS</span> T </span><br><span class="line"><span class="keyword">WHERE</span> </span><br><span class="line">ID <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> P_ID <span class="keyword">FROM</span> TREE <span class="keyword">WHERE</span> P_ID <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>)</span><br><span class="line"><span class="keyword">AND</span></span><br><span class="line">(P_ID <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	id,</span><br><span class="line"><span class="keyword">CASE</span> <span class="keyword">WHEN</span> p_id <span class="keyword">is</span> <span class="keyword">null</span> <span class="keyword">then</span> <span class="string">&#x27;Root&#x27;</span></span><br><span class="line">	 <span class="keyword">WHEN</span> id <span class="keyword">in</span> (<span class="keyword">select</span> <span class="keyword">distinct</span> p_id <span class="keyword">from</span> tree) <span class="keyword">then</span> <span class="string">&#x27;Inner&#x27;</span> <span class="keyword">else</span> <span class="string">&#x27;Leaf&#x27;</span> <span class="keyword">end</span> <span class="keyword">as</span> type</span><br><span class="line"><span class="keyword">from</span> tree;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="💪get-10"><a href="#💪get-10" class="headerlink" title="💪get"></a>💪get</h4><h4 id="🙃source-10"><a href="#🙃source-10" class="headerlink" title="🙃source"></a>🙃source</h4><p><a href="">source</a></p>
<h2 id="第二高的薪水"><a href="#第二高的薪水" class="headerlink" title="第二高的薪水"></a>第二高的薪水</h2><p>2022-04-25</p>
<h4 id="🙈Introduction-11"><a href="#🙈Introduction-11" class="headerlink" title="🙈Introduction"></a>🙈Introduction</h4><p><code>Employee</code> 表：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">-------------+------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">Column</span> Name <span class="operator">|</span> Type <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+------+</span></span><br><span class="line"><span class="operator">|</span> id          <span class="operator">|</span> <span class="type">int</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> salary      <span class="operator">|</span> <span class="type">int</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+------+</span></span><br><span class="line">id 是这个表的主键。</span><br><span class="line">表的每一行包含员工的工资信息。</span><br></pre></td></tr></table></figure><br>编写一个 SQL 查询，获取并返回 <code>Employee</code> 表中第二高的薪水 。如果不存在第二高的薪水，查询应该返回 <code>null</code> 。</p>
<h4 id="🤔code-11"><a href="#🤔code-11" class="headerlink" title="🤔code"></a>🤔code</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--first version</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">max</span>(Salary) SecondHighestSalary</span><br><span class="line"><span class="keyword">FROM</span> Employee  </span><br><span class="line"><span class="keyword">where</span> Salary <span class="operator">!=</span> (<span class="keyword">select</span> <span class="built_in">max</span>(Salary) <span class="keyword">from</span> Employee );</span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    (</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span></span><br><span class="line">    Salary</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    Employee</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> Salary <span class="keyword">DESC</span></span><br><span class="line">LIMIT <span class="number">1</span> <span class="keyword">OFFSET</span> <span class="number">1</span></span><br><span class="line">) <span class="keyword">AS</span> SecondHighestSalary</span><br><span class="line"><span class="comment">--使用select输出，否则当不存在第二高时候输出为空而不是null</span></span><br><span class="line"><span class="keyword">SELECT</span> (</span><br><span class="line">       <span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> salary</span><br><span class="line">       <span class="keyword">FROM</span> Employee</span><br><span class="line">       <span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span></span><br><span class="line">       LIMIT <span class="number">1</span>,<span class="number">1</span></span><br><span class="line">) SecondHighestSalary;</span><br></pre></td></tr></table></figure>
<h4 id="💪get-11"><a href="#💪get-11" class="headerlink" title="💪get"></a>💪get</h4><ul>
<li><code>limit m,n</code>：m为跳过的数据数量，n为要取的数据数量。</li>
<li><code>limit m</code>：m为要取的数据数量</li>
<li><code>limit m offset n</code>：m为要取的数据数量，n为跳过的数据数量<br>[[sql条件运算#使用 LIMIT 限制输出行数|limit基础]]<h4 id="🙃source-11"><a href="#🙃source-11" class="headerlink" title="🙃source"></a>🙃source</h4><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/second-highest-salary/">source</a></li>
</ul>
<h2 id="张三的MySQL学习之路（三）"><a href="#张三的MySQL学习之路（三）" class="headerlink" title="张三的MySQL学习之路（三）"></a>张三的MySQL学习之路（三）</h2><p>2022-04-23</p>
<h4 id="🙈Introduction-12"><a href="#🙈Introduction-12" class="headerlink" title="🙈Introduction"></a>🙈Introduction</h4><p>描述</p>
<p>张三在宿舍里打游戏，今天运气不太好，总是被匹配的队友坑，气得张三直接就把游戏给卸载了。没心情去吃饭的张三打开 QQ，发现有 999+ 的信息，原来是学校的老师给他发来的消息，想要他帮忙创建一个 SQL 视图 <code>v_best_teachers</code>，要他赶紧写好发过去。张三看了看需求，边看要求边写 SQL，结果发现…不对！<strong>学校的要求是查出每个国家最受欢迎的老师信息（听课学生数越多越受欢迎），并按国籍升序排序</strong>。现在张三在知识分享过程中，拿这道题来考你，并嘲讽你不能做出来……小伙子，打脸张三的时候到了，还在等什么 ？冲</p>
<h4 id="🤔code-12"><a href="#🤔code-12" class="headerlink" title="🤔code"></a>🤔code</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">view</span> v_best_teachers</span><br><span class="line"><span class="keyword">as</span> </span><br><span class="line"><span class="keyword">select</span> teacher_id, student_count, country, email</span><br><span class="line"><span class="keyword">from</span>(</span><br><span class="line">    <span class="keyword">select</span> teacher_id, <span class="built_in">sum</span>(student_count) student_count, country, email</span><br><span class="line">    <span class="keyword">from</span> courses c </span><br><span class="line">    <span class="keyword">inner</span> <span class="keyword">join</span> teachers t </span><br><span class="line">    <span class="keyword">on</span> c.teacher_id <span class="operator">=</span> t.id</span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> teacher_id, country, email) a</span><br><span class="line"><span class="keyword">where</span> (student_count, country) <span class="keyword">in</span>(</span><br><span class="line">    <span class="keyword">select</span> <span class="built_in">max</span>(student_count), country</span><br><span class="line">    <span class="keyword">from</span>(</span><br><span class="line">        <span class="keyword">select</span> teacher_id, <span class="built_in">sum</span>(student_count) student_count, country, email</span><br><span class="line">        <span class="keyword">from</span> courses c </span><br><span class="line">        <span class="keyword">inner</span> <span class="keyword">join</span> teachers t </span><br><span class="line">        <span class="keyword">on</span> c.teacher_id <span class="operator">=</span> t.id</span><br><span class="line">        <span class="keyword">group</span> <span class="keyword">by</span> teacher_id, country, email) aa</span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> country)</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> country;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">view</span> if <span class="keyword">exists</span> v_best_teachers;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">view</span> v_best_teachers  <span class="keyword">as</span> </span><br><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> teacher_id,student_count,country,email</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line">    <span class="keyword">select</span> id <span class="keyword">as</span> teacher_id,<span class="built_in">max</span>(student_count) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> country ) <span class="keyword">as</span> student_count_1,country,email</span><br><span class="line">    ,student_count</span><br><span class="line">    <span class="keyword">from</span> (</span><br><span class="line">        <span class="keyword">select</span> a.id, email,country,<span class="built_in">sum</span>(student_count)</span><br><span class="line">        <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> a.id,country) <span class="keyword">as</span> student_count</span><br><span class="line">        <span class="keyword">from</span> teachers a</span><br><span class="line">        <span class="keyword">inner</span> <span class="keyword">join</span> courses b </span><br><span class="line">        <span class="keyword">on</span> a.id <span class="operator">=</span> b.teacher_id </span><br><span class="line">        ) t </span><br><span class="line">    ) tt </span><br><span class="line"><span class="keyword">where</span> tt.student_count_1 <span class="operator">=</span>tt.student_count</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> country</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">view</span> v_best_teachers <span class="keyword">as</span>(</span><br><span class="line"><span class="keyword">select</span> ct.teacher_id <span class="keyword">as</span> teacher_id,</span><br><span class="line">ct.s_student_count <span class="keyword">as</span> student_count,</span><br><span class="line">ct.country <span class="keyword">as</span> country,</span><br><span class="line">ct.email <span class="keyword">as</span> email</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line">    <span class="keyword">select</span> c.teacher_id,c.s_student_count,t.country,t.email,</span><br><span class="line"><span class="built_in">rank</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> country <span class="keyword">order</span> <span class="keyword">by</span> s_student_count <span class="keyword">desc</span>) <span class="keyword">as</span> orde</span><br><span class="line"><span class="keyword">from</span>(</span><br><span class="line"><span class="keyword">select</span> teacher_id,<span class="built_in">sum</span>(student_count) <span class="keyword">as</span> s_student_count <span class="keyword">from</span> courses</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> teacher_id</span><br><span class="line">) <span class="keyword">as</span> c</span><br><span class="line"><span class="keyword">join</span> teachers t </span><br><span class="line"><span class="keyword">on</span> c.teacher_id<span class="operator">=</span>t.id) <span class="keyword">as</span> ct</span><br><span class="line"><span class="keyword">where</span> ct.orde<span class="operator">=</span><span class="number">1</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> country</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h4 id="💪get-12"><a href="#💪get-12" class="headerlink" title="💪get"></a>💪get</h4><ul>
<li>注意<code>join</code>中数据的重复次数，会造成数据出现重复。</li>
<li>聚合函数要和<code>group by</code>联用，mysql要去by后面为全select关键词，即除了聚合函数。</li>
</ul>
<h4 id="🙃source-12"><a href="#🙃source-12" class="headerlink" title="🙃source"></a>🙃source</h4><p><a target="_blank" rel="noopener" href="https://www.lintcode.com/learn/153/683">source</a></p>
<h2 id="挂科最多的同学-II"><a href="#挂科最多的同学-II" class="headerlink" title="挂科最多的同学 II"></a>挂科最多的同学 II</h2><p>2022-04-25</p>
<h4 id="🙈Introduction-13"><a href="#🙈Introduction-13" class="headerlink" title="🙈Introduction"></a>🙈Introduction</h4><p>描述<br><code>exams</code> 表中存放着同学们的考试记录<br>请用 SQL 语句，找到挂科数最多的同学所对应的 <code>student_id</code></p>
<h4 id="🤔code-13"><a href="#🤔code-13" class="headerlink" title="🤔code"></a>🤔code</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> student_id</span><br><span class="line"><span class="keyword">FROM</span> exams</span><br><span class="line"><span class="keyword">WHERE</span> is_pass <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> student_id</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">count</span>(<span class="operator">*</span>)<span class="operator">=</span>(</span><br><span class="line">     <span class="keyword">SELECT</span> <span class="built_in">max</span>(bb.a)</span><br><span class="line">     <span class="keyword">FROM</span> (</span><br><span class="line">          <span class="keyword">SELECT</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> a</span><br><span class="line">          <span class="keyword">FROM</span> exams <span class="keyword">WHERE</span> is_pass<span class="operator">=</span><span class="number">0</span> <span class="keyword">group</span> <span class="keyword">by</span> student_id</span><br><span class="line">     ) <span class="keyword">as</span> bb</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">--2</span></span><br><span class="line"><span class="keyword">SELECT</span> student_id <span class="keyword">FROM</span>(</span><br><span class="line">     <span class="keyword">SELECT</span> student_id,is_pass,<span class="built_in">count</span>(is_pass) num</span><br><span class="line">     <span class="keyword">FROM</span> exams</span><br><span class="line">     <span class="keyword">WHERE</span> is_pass<span class="operator">=</span><span class="number">0</span></span><br><span class="line">     <span class="keyword">group</span> <span class="keyword">by</span> student_id</span><br><span class="line">) t</span><br><span class="line"></span><br><span class="line"><span class="keyword">WHERE</span> num<span class="operator">=</span>(</span><br><span class="line">     <span class="keyword">SELECT</span> <span class="built_in">max</span>(num) <span class="keyword">FROM</span>(</span><br><span class="line">     <span class="keyword">SELECT</span> student_id,is_pass,<span class="built_in">count</span>(is_pass) num</span><br><span class="line">     <span class="keyword">FROM</span> exams</span><br><span class="line">     <span class="keyword">WHERE</span> is_pass<span class="operator">=</span><span class="number">0</span></span><br><span class="line">     <span class="keyword">group</span> <span class="keyword">by</span> student_id</span><br><span class="line">     ) tt</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h4 id="💪get-13"><a href="#💪get-13" class="headerlink" title="💪get"></a>💪get</h4><ul>
<li>where后不可以跟[[函数#算数函数|聚合函数]]</li>
</ul>
<h4 id="🙃source-13"><a href="#🙃source-13" class="headerlink" title="🙃source"></a>🙃source</h4><p><a target="_blank" rel="noopener" href="https://www.lintcode.com/problem/1933/solution/45386">source</a></p>
<h2 id="进店却未进行过交易的顾客"><a href="#进店却未进行过交易的顾客" class="headerlink" title="进店却未进行过交易的顾客"></a>进店却未进行过交易的顾客</h2><p>2022-04-26</p>
<h4 id="🙈Introduction-14"><a href="#🙈Introduction-14" class="headerlink" title="🙈Introduction"></a>🙈Introduction</h4><p>表：<code>Visits</code><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">-------------+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">Column</span> Name <span class="operator">|</span> Type    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+---------+</span></span><br><span class="line"><span class="operator">|</span> visit_id    <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> customer_id <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+---------+</span></span><br><span class="line">visit_id 是该表的主键。</span><br><span class="line">该表包含有关光临过购物中心的顾客的信息。</span><br></pre></td></tr></table></figure><br>表：<code>Transactions</code><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">----------------+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">Column</span> Name    <span class="operator">|</span> Type    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+---------+</span></span><br><span class="line"><span class="operator">|</span> transaction_id <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> visit_id       <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> amount         <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+---------+</span></span><br><span class="line">transaction_id 是此表的主键。</span><br><span class="line">此表包含 visit_id 期间进行的交易的信息。</span><br></pre></td></tr></table></figure><br>有一些顾客可能光顾了购物中心但没有进行交易。请你编写一个 SQL 查询，来查找这些顾客的 ID ，以及他们只光顾不交易的次数。</p>
<h4 id="🤔code-14"><a href="#🤔code-14" class="headerlink" title="🤔code"></a>🤔code</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--first version</span></span><br><span class="line"><span class="keyword">select</span> customer_id,<span class="built_in">count</span>(visit_id) count_no_trans</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line">    <span class="keyword">select</span> v.visit_id,v.customer_id</span><br><span class="line">    <span class="keyword">from</span> Visits v</span><br><span class="line">    <span class="keyword">left</span> <span class="keyword">join</span> Transactions t</span><br><span class="line">    <span class="keyword">on</span> v.visit_id<span class="operator">=</span>t.visit_id</span><br><span class="line">    <span class="keyword">where</span> t.transaction_id <span class="keyword">is</span> <span class="keyword">null</span></span><br><span class="line">) tt</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> customer_id</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> count_no_trans <span class="keyword">desc</span>;</span><br><span class="line"><span class="comment">--second version</span></span><br><span class="line"><span class="keyword">select</span> customer_id,<span class="built_in">count</span>(v.visit_id) <span class="keyword">as</span> count_no_trans</span><br><span class="line"><span class="keyword">from</span> Visits <span class="keyword">as</span> v</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> Transactions <span class="keyword">as</span> t</span><br><span class="line"><span class="keyword">on</span> v.visit_id<span class="operator">=</span>t.visit_id</span><br><span class="line"><span class="keyword">where</span> t.Transaction_id <span class="keyword">is</span> <span class="keyword">null</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> customer_id</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> count_no_trans;</span><br></pre></td></tr></table></figure>
<h4 id="💪get-14"><a href="#💪get-14" class="headerlink" title="💪get"></a>💪get</h4><h4 id="🙃source-14"><a href="#🙃source-14" class="headerlink" title="🙃source"></a>🙃source</h4><p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/customer-who-visited-but-did-not-make-any-transactions/submissions/">source</a></p>
<h2 id="上升温度"><a href="#上升温度" class="headerlink" title="上升温度"></a>上升温度</h2><p>2022-04-27</p>
<h4 id="🙈Introduction-15"><a href="#🙈Introduction-15" class="headerlink" title="🙈Introduction"></a>🙈Introduction</h4><p>表： <code>Weather</code><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">---------------+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">Column</span> Name   <span class="operator">|</span> Type    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+---------+</span></span><br><span class="line"><span class="operator">|</span> id            <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> recordDate    <span class="operator">|</span> <span class="type">date</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> temperature   <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+---------+</span></span><br><span class="line">id 是这个表的主键</span><br><span class="line">该表包含特定日期的温度信息</span><br></pre></td></tr></table></figure><br>编写一个 SQL 查询，来查找与之前（昨天的）日期相比温度更高的所有日期的 <code>id</code> 。</p>
<h4 id="🤔code-15"><a href="#🤔code-15" class="headerlink" title="🤔code"></a>🤔code</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--first version</span></span><br><span class="line"><span class="keyword">select</span> w1.id <span class="keyword">from</span> Weather w1</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> Weather w2</span><br><span class="line"><span class="keyword">on</span> w1.recordDate<span class="operator">=</span>date_add(w2.recordDate,<span class="type">interval</span> <span class="number">1</span> <span class="keyword">day</span>)</span><br><span class="line"><span class="keyword">where</span> w1.Temperature<span class="operator">&gt;</span>w2.Temperature;</span><br><span class="line"><span class="comment">--sencond version</span></span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">    b.Id </span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">    weather a </span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> </span><br><span class="line">    weather b </span><br><span class="line"><span class="keyword">where</span> </span><br><span class="line">    DATEDIFF(b.recordDate,a.recordDate)<span class="operator">=</span><span class="number">1</span> </span><br><span class="line"><span class="keyword">and</span> b.Temperature <span class="operator">&gt;</span> a.Temperature;</span><br></pre></td></tr></table></figure>
<h4 id="💪get-15"><a href="#💪get-15" class="headerlink" title="💪get"></a>💪get</h4><ul>
<li><code>inner join()</code>当不存在on时相当于笛卡尔积</li>
<li><code>DATEDIFF(date1,date2)</code>:返回两个日期之间的天数</li>
</ul>
<h4 id="🙃source-15"><a href="#🙃source-15" class="headerlink" title="🙃source"></a>🙃source</h4><p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/rising-temperature/solution/by-jam007-658v/">source</a></p>
<h2 id="订单最多的客户"><a href="#订单最多的客户" class="headerlink" title="订单最多的客户"></a>订单最多的客户</h2><p>2022-04-29</p>
<h4 id="🙈Introduction-16"><a href="#🙈Introduction-16" class="headerlink" title="🙈Introduction"></a>🙈Introduction</h4><p>表: <code>Orders</code><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">-----------------+----------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">Column</span> Name     <span class="operator">|</span> Type     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+----------+</span></span><br><span class="line"><span class="operator">|</span> order_number    <span class="operator">|</span> <span class="type">int</span>      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> customer_number <span class="operator">|</span> <span class="type">int</span>      <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+----------+</span></span><br><span class="line">Order_number是该表的主键。</span><br><span class="line">此表包含关于订单ID和客户ID的信息。</span><br></pre></td></tr></table></figure><br>编写一个SQL查询，为下了 <strong>最多订单</strong> 的客户查找 <code>customer_number</code> 。<br>测试用例生成后， <strong>恰好有一个客户</strong> 比任何其他客户下了更多的订单。</p>
<h4 id="🤔code-16"><a href="#🤔code-16" class="headerlink" title="🤔code"></a>🤔code</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--my version 482ms</span></span><br><span class="line"><span class="keyword">select</span> customer_number</span><br><span class="line"><span class="keyword">from</span> Orders</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> customer_number</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">count</span>(customer_number)<span class="operator">=</span>(</span><br><span class="line">    <span class="keyword">select</span> <span class="built_in">count</span>(customer_number) <span class="keyword">as</span> count </span><br><span class="line">    <span class="keyword">from</span> Orders </span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> customer_number </span><br><span class="line">    <span class="keyword">order</span> <span class="keyword">by</span> count <span class="keyword">desc</span></span><br><span class="line">    limit <span class="number">1</span>);</span><br><span class="line"><span class="comment">--other version</span></span><br><span class="line"><span class="keyword">select</span> customer_number</span><br><span class="line"><span class="keyword">from</span> orders</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> customer_number</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">count</span>(order_number)<span class="operator">&gt;=</span><span class="keyword">all</span>(</span><br><span class="line">    <span class="keyword">select</span> <span class="built_in">count</span>(order_number)</span><br><span class="line">    <span class="keyword">from</span> orders</span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> customer_number</span><br><span class="line">)</span><br><span class="line"><span class="comment">--order 479ms不严谨</span></span><br><span class="line"><span class="keyword">select</span> customer_number</span><br><span class="line"><span class="keyword">from</span> orders </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> customer_number</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> <span class="built_in">count</span>(order_number)  <span class="keyword">desc</span></span><br><span class="line">limit <span class="number">1</span></span><br><span class="line"><span class="comment">--rank() 503ms</span></span><br><span class="line"><span class="keyword">select</span> t.customer_number</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(<span class="keyword">select</span> customer_number, <span class="built_in">rank</span>() <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> <span class="built_in">count</span>(order_number) <span class="keyword">desc</span>) <span class="keyword">as</span> ranking</span><br><span class="line"><span class="keyword">from</span> orders</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> customer_number) t</span><br><span class="line"><span class="keyword">where</span> t.ranking <span class="operator">=</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>
<h4 id="💪get-16"><a href="#💪get-16" class="headerlink" title="💪get"></a>💪get</h4><ul>
<li><code>order by()</code>：可用聚合函数进行排序</li>
<li><code>ALL</code>运算符是一个逻辑运算符，它将单个值与子查询返回的单列值集进行比较。SQL <code>ALL</code>运算符必须以比较运算符开头，例如：<code>&gt;</code>，<code>&gt;=</code>，<code>&lt;</code>，<code>&lt;=</code>，<code>&lt;&gt;</code>，<code>=</code>，后跟子查询。 某些数据库系统(如Oracle)允许使用文字值列表而不是子查询。<h4 id="🙃source-16"><a href="#🙃source-16" class="headerlink" title="🙃source"></a>🙃source</h4><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/customer-placing-the-largest-number-of-orders/">source</a><h2 id="排名靠前的旅行者"><a href="#排名靠前的旅行者" class="headerlink" title="排名靠前的旅行者"></a>排名靠前的旅行者</h2>2022-04-30</li>
</ul>
<h4 id="🙈Introduction-17"><a href="#🙈Introduction-17" class="headerlink" title="🙈Introduction"></a>🙈Introduction</h4><p>表：<code>Users</code><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">---------------+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">Column</span> Name   <span class="operator">|</span> Type    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+---------+</span></span><br><span class="line"><span class="operator">|</span> id            <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> name          <span class="operator">|</span> <span class="type">varchar</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+---------+</span></span><br><span class="line">id 是该表单主键。</span><br><span class="line">name 是用户名字。</span><br></pre></td></tr></table></figure><br>表：<code>Rides</code><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">---------------+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">Column</span> Name   <span class="operator">|</span> Type    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+---------+</span></span><br><span class="line"><span class="operator">|</span> id            <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> user_id       <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> distance      <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+---------+</span></span><br><span class="line">id 是该表单主键。</span><br><span class="line">user_id 是本次行程的用户的 id, 而该用户此次行程距离为 distance 。</span><br></pre></td></tr></table></figure><br>写一段 SQL , 报告每个用户的旅行距离。</p>
<p>返回的结果表单，以 travelled_distance 降序排列 ，如果有两个或者更多的用户旅行了相同的距离, 那么再以 name 升序排列 。</p>
<h4 id="🤔code-17"><a href="#🤔code-17" class="headerlink" title="🤔code"></a>🤔code</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--my version</span></span><br><span class="line"><span class="keyword">select</span> u.name,if(<span class="built_in">sum</span>(r.distance) <span class="keyword">is</span> <span class="keyword">null</span>, <span class="number">0</span>,<span class="built_in">sum</span>(r.distance)) <span class="keyword">as</span> travelled_distance</span><br><span class="line"><span class="keyword">from</span> Users u</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> Rides r</span><br><span class="line"><span class="keyword">on</span> r.user_id<span class="operator">=</span>u.id</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> r.user_id</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> travelled_distance <span class="keyword">desc</span>,name <span class="keyword">asc</span>;</span><br><span class="line"><span class="comment">--ifnull</span></span><br><span class="line"><span class="keyword">select</span> u.name,ifnull(<span class="built_in">sum</span>(r.distance), <span class="number">0</span>) <span class="keyword">as</span> travelled_distance</span><br><span class="line"><span class="keyword">from</span> Users u</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> Rides r</span><br><span class="line"><span class="keyword">on</span> r.user_id<span class="operator">=</span>u.id</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> r.user_id</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> travelled_distance <span class="keyword">desc</span>,name <span class="keyword">asc</span>;</span><br><span class="line"><span class="comment">--coalesce  </span></span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">    name, <span class="built_in">coalesce</span>(<span class="built_in">sum</span>(distance), <span class="number">0</span>) travelled_distance</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">    users u</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> rides r <span class="keyword">on</span> u.id<span class="operator">=</span>r.user_id</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> name</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> travelled_distance <span class="keyword">desc</span>, name;</span><br></pre></td></tr></table></figure>
<h4 id="💪get-17"><a href="#💪get-17" class="headerlink" title="💪get"></a>💪get</h4><ul>
<li><code>ifnulll</code>:MySQL <code>IFNULL(expression_1,expression_2)</code>函数是MySQL控制流函数之一，它接受两个参数，如果不是<code>NULL</code>，则返回第一个参数。 否则，<code>IFNULL</code>函数返回第二个参数。两个参数可以是文字值或表达式。</li>
<li><code>COALESCE</code>是一个函数， <code>(expression_1, expression_2, ...,expression_n)</code>依次参考各参数表达式，遇到非null值即停止并返回该值。如果所有的表达式都是空值，最终将返回一个空值。使用COALESCE在于大部分包含空值的表达式最终将返回空值。</li>
</ul>
<h4 id="🙃source-17"><a href="#🙃source-17" class="headerlink" title="🙃source"></a>🙃source</h4><p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/top-travellers/">source</a><br><a target="_blank" rel="noopener" href="https://www.yiibai.com/mysql/ifnull.html">ifnull</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/yilulvxing/article/details/86595725">coalesce</a></p>
<h2 id="市场分析（一）"><a href="#市场分析（一）" class="headerlink" title="市场分析（一）"></a>市场分析（一）</h2><p>2022-04-30</p>
<h4 id="🙈Introduction-18"><a href="#🙈Introduction-18" class="headerlink" title="🙈Introduction"></a>🙈Introduction</h4><p>Table: <code>Users</code><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">----------------+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">Column</span> Name    <span class="operator">|</span> Type    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+---------+</span></span><br><span class="line"><span class="operator">|</span> user_id        <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> join_date      <span class="operator">|</span> <span class="type">date</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> favorite_brand <span class="operator">|</span> <span class="type">varchar</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+---------+</span></span><br><span class="line">此表主键是 user_id。</span><br><span class="line">表中描述了购物网站的用户信息，用户可以在此网站上进行商品买卖。</span><br></pre></td></tr></table></figure><br>Table: <code>Orders</code><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">---------------+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">Column</span> Name   <span class="operator">|</span> Type    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+---------+</span></span><br><span class="line"><span class="operator">|</span> order_id      <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> order_date    <span class="operator">|</span> <span class="type">date</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> item_id       <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> buyer_id      <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> seller_id     <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+---------+</span></span><br><span class="line">此表主键是 order_id。</span><br><span class="line">外键是 item_id 和（buyer_id，seller_id）。</span><br></pre></td></tr></table></figure><br>Table: <code>Items</code><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">---------------+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">Column</span> Name   <span class="operator">|</span> Type    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+---------+</span></span><br><span class="line"><span class="operator">|</span> item_id       <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> item_brand    <span class="operator">|</span> <span class="type">varchar</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+---------+</span></span><br><span class="line">此表主键是 item_id。</span><br></pre></td></tr></table></figure><br>请写出一条SQL语句以查询每个用户的注册日期和在 <strong><code>2019</code></strong> 年作为买家的订单总数。<br>以 <strong>任意顺序</strong> 返回结果表。</p>
<h4 id="🤔code-18"><a href="#🤔code-18" class="headerlink" title="🤔code"></a>🤔code</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--my version</span></span><br><span class="line"><span class="keyword">select</span> u.user_id <span class="keyword">as</span> buyer_id,u.join_date,<span class="built_in">count</span>(ee.order_date) <span class="keyword">as</span> <span class="string">&#x27;orders_in_2019&#x27;</span></span><br><span class="line"><span class="keyword">from</span> Users <span class="keyword">as</span> u</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> (</span><br><span class="line">    <span class="keyword">select</span> order_date,buyer_id</span><br><span class="line">    <span class="keyword">from</span> Orders</span><br><span class="line">    <span class="keyword">where</span> <span class="keyword">year</span>(order_date)<span class="operator">=</span><span class="number">2019</span></span><br><span class="line">) <span class="keyword">as</span> ee </span><br><span class="line"><span class="keyword">on</span> ee.buyer_id<span class="operator">=</span>u.user_id</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> u.user_id</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> buyer_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">--将时间判断放在on中避免where直接筛选掉ID为3和4的情况，放在on还会保留ID为3和4的情况且值为null</span></span><br><span class="line"><span class="keyword">select</span> user_id buyer_id, join_date, <span class="built_in">count</span>(order_id) orders_in_2019</span><br><span class="line"><span class="keyword">from</span> users <span class="keyword">left</span> <span class="keyword">join</span> orders</span><br><span class="line"><span class="keyword">on</span> user_id <span class="operator">=</span> buyer_id <span class="keyword">and</span> <span class="keyword">year</span>(order_date)<span class="operator">=</span><span class="string">&#x27;2019&#x27;</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> user_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">--先给非2019的赋值，使用sum()计算</span></span><br><span class="line"><span class="keyword">select</span> user_id buyer_id, join_date,</span><br><span class="line"><span class="built_in">sum</span>(if(<span class="keyword">year</span>(order_date)<span class="operator">=</span><span class="string">&#x27;2019&#x27;</span>,<span class="number">1</span>,<span class="number">0</span>)) orders_in_2019</span><br><span class="line"><span class="keyword">from</span> users <span class="keyword">left</span> <span class="keyword">join</span> orders</span><br><span class="line"><span class="keyword">on</span> user_id <span class="operator">=</span> buyer_id</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> user_id</span><br></pre></td></tr></table></figure>
<h4 id="💪get-18"><a href="#💪get-18" class="headerlink" title="💪get"></a>💪get</h4><ul>
<li>on后面可以接筛选条件，与where基本没有区别，仅在outer join存在区别。outer join步骤如下：</li>
</ul>
<ol>
<li>对两个表进行笛卡尔积</li>
<li>应用on筛选条件</li>
<li><code>添加外部行</code>(这一步会添加依赖列表在筛选后不存在的行)</li>
<li>应用where筛选器<h4 id="🙃source-18"><a href="#🙃source-18" class="headerlink" title="🙃source"></a>🙃source</h4><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/market-analysis-i/comments/">source</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_42434318/article/details/112819267">on与where筛选的区别</a></li>
</ol>
<h2 id="销售分析"><a href="#销售分析" class="headerlink" title="销售分析"></a>销售分析</h2><p>2022-05-01</p>
<h4 id="🙈Introduction-19"><a href="#🙈Introduction-19" class="headerlink" title="🙈Introduction"></a>🙈Introduction</h4><p>Table: <code>Product</code><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">--------------+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">Column</span> Name  <span class="operator">|</span> Type    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------+---------+</span></span><br><span class="line"><span class="operator">|</span> product_id   <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> product_name <span class="operator">|</span> <span class="type">varchar</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> unit_price   <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------+---------+</span></span><br><span class="line">Product_id是该表的主键。</span><br><span class="line">该表的每一行显示每个产品的名称和价格。</span><br></pre></td></tr></table></figure><br>Table: <code>Sales</code><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">-------------+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">Column</span> Name <span class="operator">|</span> Type    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+---------+</span></span><br><span class="line"><span class="operator">|</span> seller_id   <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> product_id  <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> buyer_id    <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> sale_date   <span class="operator">|</span> <span class="type">date</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> quantity    <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> price       <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------ ------+---------+</span></span><br><span class="line">这个表没有主键，它可以有重复的行。</span><br><span class="line">product_id 是 Product 表的外键。</span><br><span class="line">该表的每一行包含关于一个销售的一些信息。</span><br></pre></td></tr></table></figure><br>编写一个SQL查询，报告<code>2019年春季</code>才售出的产品。即<strong>仅</strong>在<code>**2019-01-01**</code>至<code>**2019-03-31**</code>（含）之间出售的商品。</p>
<h4 id="🤔code-19"><a href="#🤔code-19" class="headerlink" title="🤔code"></a>🤔code</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--my version 622ms</span></span><br><span class="line"><span class="keyword">select</span> product_id,product_name</span><br><span class="line"><span class="keyword">from</span> Product</span><br><span class="line"><span class="keyword">where</span> product_id <span class="keyword">not</span> <span class="keyword">in</span> (</span><br><span class="line">    <span class="keyword">select</span> p.product_id</span><br><span class="line">    <span class="keyword">from</span> Product <span class="keyword">as</span> p</span><br><span class="line">    <span class="keyword">left</span> <span class="keyword">join</span> Sales <span class="keyword">as</span> s</span><br><span class="line">    <span class="keyword">on</span> p.product_id<span class="operator">=</span>s.product_id</span><br><span class="line">    <span class="keyword">where</span> s.sale_date <span class="keyword">not</span> <span class="keyword">between</span> <span class="string">&#x27;2019-01-01&#x27;</span> <span class="keyword">and</span> <span class="string">&#x27;2019-03-31&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">--sum计数排除 634ms</span></span><br><span class="line"><span class="keyword">SELECT</span> p.product_id,product_name <span class="keyword">FROM</span> sales s,product p </span><br><span class="line"><span class="keyword">WHERE</span> s.product_id<span class="operator">=</span>p.product_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> p.product_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">SUM</span>(sale_date <span class="operator">&lt;</span> <span class="string">&#x27;2019-01-01&#x27;</span>)<span class="operator">=</span><span class="number">0</span></span><br><span class="line"><span class="keyword">AND</span> <span class="built_in">SUM</span>(sale_date<span class="operator">&gt;</span><span class="string">&#x27;2019-03-31&#x27;</span>)<span class="operator">=</span><span class="number">0</span>;</span><br></pre></td></tr></table></figure>
<h4 id="💪get-19"><a href="#💪get-19" class="headerlink" title="💪get"></a>💪get</h4><ul>
<li>采用聚合函数进行计数，实现要求，但效率不高。<h4 id="🙃source-19"><a href="#🙃source-19" class="headerlink" title="🙃source"></a>🙃source</h4><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/sales-analysis-iii/">source</a></li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Zj_Jibo</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2022/05/01/SQL%E9%A2%98%E7%9B%AE%E8%AE%B0%E5%BD%95(%E4%B8%80)/">http://example.com/2022/05/01/SQL%E9%A2%98%E7%9B%AE%E8%AE%B0%E5%BD%95(%E4%B8%80)/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">zZZZ's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SQL/">SQL</a><a class="post-meta__tags" href="/tags/LeetCode/">LeetCode</a><a class="post-meta__tags" href="/tags/LintCode/">LintCode</a><a class="post-meta__tags" href="/tags/%E8%AE%B0%E5%BD%95/">记录</a></div><div class="post_share"><div class="social-share" data-image="https://s2.loli.net/2022/04/29/XE8p2nWdrub9SOG.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2022/04/29/python-%E8%A3%85%E9%A5%B0%E5%99%A8/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://s2.loli.net/2022/04/29/9ZuPDNUYzShvdXf.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">python_装饰器</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://s2.loli.net/2022/04/28/xONf6RXakT8oIu1.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Zj_Jibo</div><div class="author-info__description"></div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">6</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">16</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/zjiibo"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/zjjibo" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:zjjibo@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">记录学习过程</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E9%87%8D%E5%A4%8D%E7%9A%84%E7%94%B5%E5%AD%90%E9%82%AE%E7%AE%B1"><span class="toc-number">1.</span> <span class="toc-text">删除重复的电子邮箱</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%99%88Introduction"><span class="toc-number">1.0.1.</span> <span class="toc-text">🙈Introduction</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%A4%94code"><span class="toc-number">1.0.2.</span> <span class="toc-text">🤔code</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%AAget"><span class="toc-number">1.0.3.</span> <span class="toc-text">💪get</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%99%83source"><span class="toc-number">1.0.4.</span> <span class="toc-text">🙃source</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E7%89%B9%E6%AE%8A%E5%A5%96%E9%87%91"><span class="toc-number">2.</span> <span class="toc-text">计算特殊奖金</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%99%88Introduction-1"><span class="toc-number">2.0.1.</span> <span class="toc-text">🙈Introduction</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%A4%94code-1"><span class="toc-number">2.0.2.</span> <span class="toc-text">🤔code</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%AAget-1"><span class="toc-number">2.0.3.</span> <span class="toc-text">💪get</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%99%83source-1"><span class="toc-number">2.0.4.</span> <span class="toc-text">🙃source</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%A0%E4%B8%89%E7%9A%84MySQL%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF-%E4%B8%80"><span class="toc-number">3.</span> <span class="toc-text">张三的MySQL学习之路(一)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%99%88Introduction-2"><span class="toc-number">3.0.1.</span> <span class="toc-text">🙈Introduction</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%A4%94code-2"><span class="toc-number">3.0.2.</span> <span class="toc-text">🤔code</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%AAget-2"><span class="toc-number">3.0.3.</span> <span class="toc-text">💪get</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%99%83source-2"><span class="toc-number">3.0.4.</span> <span class="toc-text">🙃source</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%A0%E4%B8%89%E7%9A%84MySQL%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF%EF%BC%88%E4%BA%8C%EF%BC%89"><span class="toc-number">4.</span> <span class="toc-text">张三的MySQL学习之路（二）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%99%88Introduction-3"><span class="toc-number">4.0.1.</span> <span class="toc-text">🙈Introduction</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%A4%94code-3"><span class="toc-number">4.0.2.</span> <span class="toc-text">🤔code</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%AAget-3"><span class="toc-number">4.0.3.</span> <span class="toc-text">💪get</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%99%83source-3"><span class="toc-number">4.0.4.</span> <span class="toc-text">🙃source</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E5%A4%8D%E8%A1%A8%E4%B8%AD%E7%9A%84%E5%90%8D%E5%AD%97"><span class="toc-number">5.</span> <span class="toc-text">修复表中的名字</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%99%88Introduction-4"><span class="toc-number">5.0.1.</span> <span class="toc-text">🙈Introduction</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%A4%94code-4"><span class="toc-number">5.0.2.</span> <span class="toc-text">🤔code</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%AAget-4"><span class="toc-number">5.0.3.</span> <span class="toc-text">💪get</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%99%83source-4"><span class="toc-number">5.0.4.</span> <span class="toc-text">🙃source</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%82%A3%E6%9F%90%E7%A7%8D%E7%96%BE%E7%97%85%E7%9A%84%E6%82%A3%E8%80%85"><span class="toc-number">6.</span> <span class="toc-text">患某种疾病的患者</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%99%88Introduction-5"><span class="toc-number">6.0.1.</span> <span class="toc-text">🙈Introduction</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%A4%94code-5"><span class="toc-number">6.0.2.</span> <span class="toc-text">🤔code</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%AAget-5"><span class="toc-number">6.0.3.</span> <span class="toc-text">💪get</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%99%83source-5"><span class="toc-number">6.0.4.</span> <span class="toc-text">🙃source</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%89%E6%97%A5%E6%9C%9F%E5%88%86%E7%BB%84%E9%94%80%E5%94%AE%E4%BA%A7%E5%93%81"><span class="toc-number">7.</span> <span class="toc-text">按日期分组销售产品</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%99%88Introduction-6"><span class="toc-number">7.0.1.</span> <span class="toc-text">🙈Introduction</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%A4%94code-6"><span class="toc-number">7.0.2.</span> <span class="toc-text">🤔code</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%AAget-6"><span class="toc-number">7.0.3.</span> <span class="toc-text">💪get</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%99%83source-6"><span class="toc-number">7.0.4.</span> <span class="toc-text">🙃source</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%A0%E4%B8%89%E7%9A%84-MySQL-%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF%EF%BC%88%E5%9B%9B"><span class="toc-number">8.</span> <span class="toc-text">张三的 MySQL 学习之路（四</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%99%88Introduction-7"><span class="toc-number">8.0.1.</span> <span class="toc-text">🙈Introduction</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%A4%94code-7"><span class="toc-number">8.0.2.</span> <span class="toc-text">🤔code</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%AAget-7"><span class="toc-number">8.0.3.</span> <span class="toc-text">💪get</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%99%83source-7"><span class="toc-number">8.0.4.</span> <span class="toc-text">🙃source</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%A2%E5%A4%B1%E4%BF%A1%E6%81%AF%E7%9A%84%E9%9B%87%E5%91%98"><span class="toc-number">9.</span> <span class="toc-text">丢失信息的雇员</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%99%88Introduction-8"><span class="toc-number">9.0.1.</span> <span class="toc-text">🙈Introduction</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%A4%94code-8"><span class="toc-number">9.0.2.</span> <span class="toc-text">🤔code</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%AAget-8"><span class="toc-number">9.0.3.</span> <span class="toc-text">💪get</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%99%83source-8"><span class="toc-number">9.0.4.</span> <span class="toc-text">🙃source</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AF%8F%E4%B8%AA%E4%BA%A7%E5%93%81%E5%9C%A8%E4%B8%8D%E5%90%8C%E5%95%86%E5%BA%97%E7%9A%84%E4%BB%B7%E6%A0%BC"><span class="toc-number">10.</span> <span class="toc-text">每个产品在不同商店的价格</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%99%88Introduction-9"><span class="toc-number">10.0.1.</span> <span class="toc-text">🙈Introduction</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%A4%94code-9"><span class="toc-number">10.0.2.</span> <span class="toc-text">🤔code</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%AAget-9"><span class="toc-number">10.0.3.</span> <span class="toc-text">💪get</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%99%83source-9"><span class="toc-number">10.0.4.</span> <span class="toc-text">🙃source</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%91%E8%8A%82%E7%82%B9"><span class="toc-number">11.</span> <span class="toc-text">树节点</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%99%88Introduction-10"><span class="toc-number">11.0.1.</span> <span class="toc-text">🙈Introduction</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%A4%94code-10"><span class="toc-number">11.0.2.</span> <span class="toc-text">🤔code</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%AAget-10"><span class="toc-number">11.0.3.</span> <span class="toc-text">💪get</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%99%83source-10"><span class="toc-number">11.0.4.</span> <span class="toc-text">🙃source</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E9%AB%98%E7%9A%84%E8%96%AA%E6%B0%B4"><span class="toc-number">12.</span> <span class="toc-text">第二高的薪水</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%99%88Introduction-11"><span class="toc-number">12.0.1.</span> <span class="toc-text">🙈Introduction</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%A4%94code-11"><span class="toc-number">12.0.2.</span> <span class="toc-text">🤔code</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%AAget-11"><span class="toc-number">12.0.3.</span> <span class="toc-text">💪get</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%99%83source-11"><span class="toc-number">12.0.4.</span> <span class="toc-text">🙃source</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%A0%E4%B8%89%E7%9A%84MySQL%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF%EF%BC%88%E4%B8%89%EF%BC%89"><span class="toc-number">13.</span> <span class="toc-text">张三的MySQL学习之路（三）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%99%88Introduction-12"><span class="toc-number">13.0.1.</span> <span class="toc-text">🙈Introduction</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%A4%94code-12"><span class="toc-number">13.0.2.</span> <span class="toc-text">🤔code</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%AAget-12"><span class="toc-number">13.0.3.</span> <span class="toc-text">💪get</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%99%83source-12"><span class="toc-number">13.0.4.</span> <span class="toc-text">🙃source</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%82%E7%A7%91%E6%9C%80%E5%A4%9A%E7%9A%84%E5%90%8C%E5%AD%A6-II"><span class="toc-number">14.</span> <span class="toc-text">挂科最多的同学 II</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%99%88Introduction-13"><span class="toc-number">14.0.1.</span> <span class="toc-text">🙈Introduction</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%A4%94code-13"><span class="toc-number">14.0.2.</span> <span class="toc-text">🤔code</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%AAget-13"><span class="toc-number">14.0.3.</span> <span class="toc-text">💪get</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%99%83source-13"><span class="toc-number">14.0.4.</span> <span class="toc-text">🙃source</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E5%BA%97%E5%8D%B4%E6%9C%AA%E8%BF%9B%E8%A1%8C%E8%BF%87%E4%BA%A4%E6%98%93%E7%9A%84%E9%A1%BE%E5%AE%A2"><span class="toc-number">15.</span> <span class="toc-text">进店却未进行过交易的顾客</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%99%88Introduction-14"><span class="toc-number">15.0.1.</span> <span class="toc-text">🙈Introduction</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%A4%94code-14"><span class="toc-number">15.0.2.</span> <span class="toc-text">🤔code</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%AAget-14"><span class="toc-number">15.0.3.</span> <span class="toc-text">💪get</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%99%83source-14"><span class="toc-number">15.0.4.</span> <span class="toc-text">🙃source</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8A%E5%8D%87%E6%B8%A9%E5%BA%A6"><span class="toc-number">16.</span> <span class="toc-text">上升温度</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%99%88Introduction-15"><span class="toc-number">16.0.1.</span> <span class="toc-text">🙈Introduction</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%A4%94code-15"><span class="toc-number">16.0.2.</span> <span class="toc-text">🤔code</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%AAget-15"><span class="toc-number">16.0.3.</span> <span class="toc-text">💪get</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%99%83source-15"><span class="toc-number">16.0.4.</span> <span class="toc-text">🙃source</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A2%E5%8D%95%E6%9C%80%E5%A4%9A%E7%9A%84%E5%AE%A2%E6%88%B7"><span class="toc-number">17.</span> <span class="toc-text">订单最多的客户</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%99%88Introduction-16"><span class="toc-number">17.0.1.</span> <span class="toc-text">🙈Introduction</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%A4%94code-16"><span class="toc-number">17.0.2.</span> <span class="toc-text">🤔code</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%AAget-16"><span class="toc-number">17.0.3.</span> <span class="toc-text">💪get</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%99%83source-16"><span class="toc-number">17.0.4.</span> <span class="toc-text">🙃source</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%92%E5%90%8D%E9%9D%A0%E5%89%8D%E7%9A%84%E6%97%85%E8%A1%8C%E8%80%85"><span class="toc-number">18.</span> <span class="toc-text">排名靠前的旅行者</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%99%88Introduction-17"><span class="toc-number">18.0.1.</span> <span class="toc-text">🙈Introduction</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%A4%94code-17"><span class="toc-number">18.0.2.</span> <span class="toc-text">🤔code</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%AAget-17"><span class="toc-number">18.0.3.</span> <span class="toc-text">💪get</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%99%83source-17"><span class="toc-number">18.0.4.</span> <span class="toc-text">🙃source</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%82%E5%9C%BA%E5%88%86%E6%9E%90%EF%BC%88%E4%B8%80%EF%BC%89"><span class="toc-number">19.</span> <span class="toc-text">市场分析（一）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%99%88Introduction-18"><span class="toc-number">19.0.1.</span> <span class="toc-text">🙈Introduction</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%A4%94code-18"><span class="toc-number">19.0.2.</span> <span class="toc-text">🤔code</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%AAget-18"><span class="toc-number">19.0.3.</span> <span class="toc-text">💪get</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%99%83source-18"><span class="toc-number">19.0.4.</span> <span class="toc-text">🙃source</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%94%80%E5%94%AE%E5%88%86%E6%9E%90"><span class="toc-number">20.</span> <span class="toc-text">销售分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%99%88Introduction-19"><span class="toc-number">20.0.1.</span> <span class="toc-text">🙈Introduction</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%A4%94code-19"><span class="toc-number">20.0.2.</span> <span class="toc-text">🤔code</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%AAget-19"><span class="toc-number">20.0.3.</span> <span class="toc-text">💪get</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%99%83source-19"><span class="toc-number">20.0.4.</span> <span class="toc-text">🙃source</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/05/01/SQL%E9%A2%98%E7%9B%AE%E8%AE%B0%E5%BD%95(%E4%B8%80)/" title="SQL题目记录(一)"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://s2.loli.net/2022/04/29/XE8p2nWdrub9SOG.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SQL题目记录(一)"/></a><div class="content"><a class="title" href="/2022/05/01/SQL%E9%A2%98%E7%9B%AE%E8%AE%B0%E5%BD%95(%E4%B8%80)/" title="SQL题目记录(一)">SQL题目记录(一)</a><time datetime="2022-05-01T02:45:10.000Z" title="发表于 2022-05-01 10:45:10">2022-05-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/04/29/python-%E8%A3%85%E9%A5%B0%E5%99%A8/" title="python_装饰器"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://s2.loli.net/2022/04/29/9ZuPDNUYzShvdXf.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="python_装饰器"/></a><div class="content"><a class="title" href="/2022/04/29/python-%E8%A3%85%E9%A5%B0%E5%99%A8/" title="python_装饰器">python_装饰器</a><time datetime="2022-04-29T08:56:37.000Z" title="发表于 2022-04-29 16:56:37">2022-04-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/04/29/python-%E5%AF%B9%E8%B1%A1/" title="python_对象"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://s2.loli.net/2022/04/29/8KH4XORbCrozgyW.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="python_对象"/></a><div class="content"><a class="title" href="/2022/04/29/python-%E5%AF%B9%E8%B1%A1/" title="python_对象">python_对象</a><time datetime="2022-04-29T08:54:15.000Z" title="发表于 2022-04-29 16:54:15">2022-04-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/04/29/sql%E8%BF%9B%E9%98%B6/" title="sql进阶"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://s2.loli.net/2022/04/29/8KH4XORbCrozgyW.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="sql进阶"/></a><div class="content"><a class="title" href="/2022/04/29/sql%E8%BF%9B%E9%98%B6/" title="sql进阶">sql进阶</a><time datetime="2022-04-29T08:41:16.000Z" title="发表于 2022-04-29 16:41:16">2022-04-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/04/28/SQL/" title="SQL基础"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="https://s2.loli.net/2022/04/29/edb23T1po8VhxsO.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SQL基础"/></a><div class="content"><a class="title" href="/2022/04/28/SQL/" title="SQL基础">SQL基础</a><time datetime="2022-04-28T10:00:14.000Z" title="发表于 2022-04-28 18:00:14">2022-04-28</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By Zj_Jibo</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="github-badge"><a style="color: #fff" rel="license" href="https://hexo.io/" target="_blank" title="由 Hexo 强力驱动"><span class="badge-subject">Powered</span><span class="badge-value bg-blue">Hexo</span></a><a style="color: #fff" rel="license" href="https://gitee.com/" target="_blank" title="静态网页托管于 GitHub Pages 和 Coding Pages 和 Gitee Pages"><span class="badge-subject">Hosted</span><span class="badge-value bg-brightgreen">GitHub & Coding & Gitee</span></a><a style="color: #fff" rel="license" href="https://www.jsdelivr.com/" target="_blank" title="jsDelivr 提供 CDN 加速服务"><span class="badge-subject">CDN</span><span class="badge-value bg-orange">jsDelivr</span></a><a style="color: #fff" rel="license" href="https://jerryc.me" target="_blank" title="站点使用 Butterfly主题"><span class="badge-subject">Theme</span><span class="badge-value bg-blue">Butterfly</span></a><a style="color: #fff" rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" title="本站点采用知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议进行许可"><span class="badge-subject"><i class="fa fa-copyright"></i></span><span class="badge-value bg-lightgrey">BY-NC-SA 4.0</span></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="https://cdn.jsdelivr.net/gh/zjwo/zjwo.github.io/js/utils.js"></script><script src="https://cdn.jsdelivr.net/gh/zjwo/zjwo.github.io/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/gh/zjwo/zjwo.github.io/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"></div><div class="aplayer no-destroy" data-id="000PeZCQ1i4XVs" data-server="tencent" data-type="artist" data-fixed="true" data-mini="true" data-listFolded="false" data-order="random" data-preload="none" data-autoplay="true" muted></div><script defer src="https://cdn.jsdelivr.net/combine/npm/jquery@latest/dist/jquery.min.js,gh/weilining/jsdelivr/jquery/circlemagic/circlemagic.min.js,gh/weilining/jsdelivr@latest/jquery/circlemagic/butterflycirclemagic.js"></script><div class="aplayer no-destroy" data-id="607367759" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="true"> </div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-show-text.min.js" data-mobile="false" data-text="富强,民主,文明,和谐,平等,公正,法治,爱国,敬业,诚信,友善" data-fontsize="15px" data-random="false" async="async"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(n){n.imageLazyLoadSetting.processImages=o;var e=n.imageLazyLoadSetting.isSPA,i=n.imageLazyLoadSetting.preloadRatio||1,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function o(){e&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,a=0;a<r.length;a++)0<=(t=(t=r[a]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(n.innerHeight*i||document.documentElement.clientHeight*i)&&function(){var t,e,n,i,o=r[a];t=o,e=function(){r=r.filter(function(t){return o!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e&&e()},t.src!==i&&(n.src=i)}()}o(),n.addEventListener("scroll",function(){var t,e;t=o,e=n,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this);</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>